"use strict";(self.webpackChunkmadaster_typescript=self.webpackChunkmadaster_typescript||[]).push([[5663],{16504:(t,e,n)=>{n.d(e,{MA:()=>l,m0:()=>y,qs:()=>m,wH:()=>b});var r=n(62991),o=n(15565),i=n(80861),a=n(70564),s=n(33763);const c=()=>i.A.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function u(t,e,n){let o="",i=0;for(;i<n;){const a=t[e+i];if(a<128)o+=String.fromCharCode(a),i++;else if(a>=192&&a<224){if(i+1>=n)throw new r.A("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const s=(31&a)<<6|63&t[e+i+1];o+=String.fromCharCode(s),i+=2}else if(a>=224&&a<240){if(i+2>=n)throw new r.A("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const s=(15&a)<<12|(63&t[e+i+1])<<6|63&t[e+i+2];o+=String.fromCharCode(s),i+=3}else{if(!(a>=240&&a<248))throw new r.A("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(i+3>=n)throw new r.A("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const s=(7&a)<<18|(63&t[e+i+1])<<12|(63&t[e+i+2])<<6|63&t[e+i+3];if(s>=65536){const t=55296+(s-65536>>10),e=56320+(1023&s);o+=String.fromCharCode(t,e)}else o+=String.fromCharCode(s);i+=4}}}return o}function h(t,e){const n={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let o=0;o<e.length;o++){const i=e[o],a=i.valueType||i.type,s=p[a];n.fields[i.property]=s(t,r),r+=v[a].BYTES_PER_ELEMENT}return n.byteCount=r,n}function f(t,e,n){const o=[];let i,a,s=0;for(a=0;a<t;a+=1){if(i=e[a],i>0){if(o.push(u(n,s,i-1)),0!==n[s+i-1])throw new r.A("string-array-error","Invalid string array: missing null termination.")}else o.push(null);s+=i}return o}function l(t,e){return new(0,v[e.valueType])(t,e.byteOffset,e.count*e.valuesPerElement)}function d(t,e,n){const i=null!=e.header?h(t,e.header):{byteOffset:0,byteCount:0,fields:{count:n}},a={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let s=i.byteCount;for(let t=0;t<e.ordering.length;t++){const n=e.ordering[t],c=(0,o.o8)(e[n]);if(c.count=i.fields.count??0,"String"===c.valueType){if(c.byteOffset=s,c.byteCount=i.fields[n+"ByteCount"],"UTF-8"!==c.encoding)throw new r.A("unsupported-encoding","Unsupported String encoding.",{encoding:c.encoding});if(c.timeEncoding&&"ECMA_ISO8601"!==c.timeEncoding)throw new r.A("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:c.timeEncoding})}else{if(!_(c.valueType))throw new r.A("unsupported-value-type","Unsupported binary valueType",{valueType:c.valueType});{const t=A(c.valueType);s+=s%t!=0?t-s%t:0,c.byteOffset=s,c.byteCount=t*c.valuesPerElement*c.count}}s+=c.byteCount??0,a.entries[n]=c}return a.byteCount=s-a.byteOffset,a}function g(t,e,n){if(e!==t&&c().error(`Invalid ${n} buffer size\n expected: ${t}, actual: ${e})`),e<t)throw new r.A("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function b(t,e){const n=h(t,e&&e.header);let r=n.byteCount;const o={isDraco:!1,header:n,byteOffset:n.byteCount,byteCount:0,vertexAttributes:{}},i=n.fields,a=null!=i.vertexCount?i.vertexCount:i.count;for(const t of e.ordering){if(!e.vertexAttributes[t])continue;const n={...e.vertexAttributes[t],byteOffset:r,count:a},i=w[t]||"_"+t;o.vertexAttributes[i]=n,r+=A(n.valueType)*n.valuesPerElement*a}const s=i.faceCount;if(e.faces&&s){o.faces={};for(const t of e.ordering){if(!e.faces[t])continue;const n={...e.faces[t],byteOffset:r,count:s};o.faces[t]=n,r+=A(n.valueType)*n.valuesPerElement*s}}const c=i.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&c){o.featureAttributes={};for(const t of e.featureAttributeOrder){if(!e.featureAttributes[t])continue;const n={...e.featureAttributes[t],byteOffset:r,count:c};o.featureAttributes[t]=n,r+=("UInt64"===n.valueType?8:A(n.valueType))*n.valuesPerElement*c}}return g(r,t.byteLength,"geometry"),o.byteCount=r-o.byteOffset,o}function m(t,e){return t&&t.compressedAttributes&&"draco"===t.compressedAttributes.encoding?function(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of t)switch(n){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}(t.compressedAttributes.attributes):t?function(t){return{isDraco:!1,isLegacy:!1,color:null!=t.color,normal:null!=t.normal,uv0:null!=t.uv0,uvRegion:null!=t.uvRegion,featureIndex:null!=t.faceRange&&null!=t.featureId}}(t):function(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const n of t.ordering)if(t.vertexAttributes[n])switch(n){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}(e)}const w={position:s.r.POSITION,normal:s.r.NORMAL,color:s.r.COLOR,uv0:s.r.UV0,region:s.r.UVREGION};function y(t,e,n){if("lepcc-rgb"===t.encoding)return(0,a.mb)(e);if("lepcc-intensity"===t.encoding)return(0,a.Ax)(e);if(null!=t.encoding&&""!==t.encoding)throw new r.A("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(c().warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),"ObjectIds"===t.ordering[0]&&t.hasOwnProperty("objectIds")&&(c().warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const o=d(e,t,n);g(o.byteOffset+o.byteCount,e.byteLength,"attribute");const i=o.entries.attributeValues||o.entries.objectIds;if(i){if("String"===i.valueType){const t=o.entries.attributeByteCounts,n=l(e,t),r=function(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}(e,i);return i.timeEncoding?function(t,e,n){return f(t,e,n).map((t=>{const e=t?Date.parse(t):null;return e&&!Number.isNaN(e)?e:null}))}(t.count,n,r):f(t.count,n,r)}return l(e,i)}throw new r.A("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const v={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},p={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function _(t){return v.hasOwnProperty(t)}function A(t){return _(t)?v[t].BYTES_PER_ELEMENT:0}},70564:(t,e,n)=>{n.d(e,{Ax:()=>w,Me:()=>u,mb:()=>g});var r=n(62991);const o=!0,i={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function a(t,e,n){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,n+i.identifierOffset,i.identifierLength)),version:e.getUint16(n+i.versionOffset,o),checksum:e.getUint32(n+i.checksumOffset,o)}}const s={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function c(t,e){return{sizeLo:t.getUint32(e+s.sizeLo,o),sizeHi:t.getUint32(e+s.sizeHi,o),minX:t.getFloat64(e+s.minX,o),minY:t.getFloat64(e+s.minY,o),minZ:t.getFloat64(e+s.minZ,o),maxX:t.getFloat64(e+s.maxX,o),maxY:t.getFloat64(e+s.maxY,o),maxZ:t.getFloat64(e+s.maxZ,o),errorX:t.getFloat64(e+s.errorX,o),errorY:t.getFloat64(e+s.errorY,o),errorZ:t.getFloat64(e+s.errorZ,o),count:t.getUint32(e+s.count,o),reserved:t.getUint32(e+s.reserved,o)}}function u(t){const e=new DataView(t,0);let n=0;const{identifier:o,version:u}=a(t,e,n);if(n+=i.byteCount,"LEPCC     "!==o)throw new r.A("lepcc-decode-error","Bad identifier");if(u>1)throw new r.A("lepcc-decode-error","Unknown version");const f=c(e,n);if(n+=s.byteCount,f.sizeHi*2**32+f.sizeLo!==t.byteLength)throw new r.A("lepcc-decode-error","Bad size");const l=new Float64Array(3*f.count),d=[],g=[],b=[],m=[];if(n=h(t,n,d),n=h(t,n,g),n=h(t,n,b),n=h(t,n,m),n!==t.byteLength)throw new r.A("lepcc-decode-error","Bad length");let w=0,y=0;for(let t=0;t<d.length;t++){y+=d[t];let e=0;for(let n=0;n<g[t];n++){e+=b[w];const t=m[w];l[3*w]=Math.min(f.maxX,f.minX+2*f.errorX*e),l[3*w+1]=Math.min(f.maxY,f.minY+2*f.errorY*y),l[3*w+2]=Math.min(f.maxZ,f.minZ+2*f.errorZ*t),w++}}return{errorX:f.errorX,errorY:f.errorY,errorZ:f.errorZ,result:l}}function h(t,e,n){const r=[];e=f(t,e,r);const o=[];for(let i=0;i<r.length;i++){o.length=0,e=f(t,e,o);for(let t=0;t<o.length;t++)n.push(o[t]+r[i])}return e}function f(t,e,n){const i=new DataView(t,e),a=i.getUint8(0),s=31&a,c=!!(32&a),u=(192&a)>>6;let h=0;if(0===u)h=i.getUint32(1,o),e+=5;else if(1===u)h=i.getUint16(1,o),e+=3;else{if(2!==u)throw new r.A("lepcc-decode-error","Bad count type");h=i.getUint8(1),e+=2}if(c)throw new r.A("lepcc-decode-error","LUT not implemented");const f=Math.ceil(h*s/8),l=new Uint8Array(t,e,f);let d=0,g=0,b=0;const m=-1>>>32-s;for(let t=0;t<h;t++){for(;g<s;)d|=l[b]<<g,g+=8,b+=1;n[t]=d&m,d>>>=s,g-=s,g+s>32&&(d|=l[b-1]>>8-g)}return e+b}const l={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function d(t,e){return{sizeLo:t.getUint32(e+l.sizeLo,o),sizeHi:t.getUint32(e+l.sizeHi,o),count:t.getUint32(e+l.count,o),colorMapCount:t.getUint16(e+l.colorMapCount,o),lookupMethod:t.getUint8(e+l.lookupMethod),compressionMethod:t.getUint8(e+l.compressionMethod)}}function g(t){const e=new DataView(t,0);let n=0;const{identifier:o,version:s}=a(t,e,n);if(n+=i.byteCount,"ClusterRGB"!==o)throw new r.A("lepcc-decode-error","Bad identifier");if(s>1)throw new r.A("lepcc-decode-error","Unknown version");const c=d(e,n);if(n+=l.byteCount,c.sizeHi*2**32+c.sizeLo!==t.byteLength)throw new r.A("lepcc-decode-error","Bad size");if((2===c.lookupMethod||1===c.lookupMethod)&&0===c.compressionMethod){if(3*c.colorMapCount+c.count+n!==t.byteLength||c.colorMapCount>256)throw new r.A("lepcc-decode-error","Bad count");const e=new Uint8Array(t,n,3*c.colorMapCount),o=new Uint8Array(t,n+3*c.colorMapCount,c.count),i=new Uint8Array(3*c.count);for(let t=0;t<c.count;t++){const n=o[t];i[3*t]=e[3*n],i[3*t+1]=e[3*n+1],i[3*t+2]=e[3*n+2]}return i}if(0===c.lookupMethod&&0===c.compressionMethod){if(3*c.count+n!==t.byteLength||0!==c.colorMapCount)throw new r.A("lepcc-decode-error","Bad count");return new Uint8Array(t,n).slice()}if(c.lookupMethod<=2&&1===c.compressionMethod){if(n+3!==t.byteLength||1!==c.colorMapCount)throw new r.A("lepcc-decode-error","Bad count");const o=e.getUint8(n),i=e.getUint8(n+1),a=e.getUint8(n+2),s=new Uint8Array(3*c.count);for(let t=0;t<c.count;t++)s[3*t]=o,s[3*t+1]=i,s[3*t+2]=a;return s}throw new r.A("lepcc-decode-error","Bad method "+c.lookupMethod+","+c.compressionMethod)}const b={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function m(t,e){return{sizeLo:t.getUint32(e+b.sizeLo,o),sizeHi:t.getUint32(e+b.sizeHi,o),count:t.getUint32(e+b.count,o),scaleFactor:t.getUint16(e+b.scaleFactor,o),bitsPerPoint:t.getUint8(e+b.bitsPerPoint),reserved:t.getUint8(e+b.reserved)}}function w(t){const e=new DataView(t,0);let n=0;const{identifier:o,version:s}=a(t,e,n);if(n+=i.byteCount,"Intensity "!==o)throw new r.A("lepcc-decode-error","Bad identifier");if(s>1)throw new r.A("lepcc-decode-error","Unknown version");const c=m(e,n);if(n+=b.byteCount,c.sizeHi*2**32+c.sizeLo!==t.byteLength)throw new r.A("lepcc-decode-error","Bad size");const u=new Uint16Array(c.count);if(8===c.bitsPerPoint){if(c.count+n!==t.byteLength)throw new r.A("lepcc-decode-error","Bad size");const e=new Uint8Array(t,n,c.count);for(let t=0;t<c.count;t++)u[t]=e[t]*c.scaleFactor}else if(16===c.bitsPerPoint){if(2*c.count+n!==t.byteLength)throw new r.A("lepcc-decode-error","Bad size");const e=new Uint16Array(t,n,c.count);for(let t=0;t<c.count;t++)u[t]=e[t]*c.scaleFactor}else{const e=[];if(f(t,n,e)!==t.byteLength)throw new r.A("lepcc-decode-error","Bad size");for(let t=0;t<c.count;t++)u[t]=e[t]*c.scaleFactor}return u}},45506:(t,e,n)=>{n.d(e,{ab:()=>pt,gm:()=>jt});var r=n(82541),o=n(79441),i=n(26110),a=n(31753),s=n(19165),c=n(80347),u=n(19913),h=n(74772),f=n(76982),l=n(34670),d=n(32159),g=n(80788),b=n(88133),m=n(91240),w=n(87368),y=n(67488),v=n(11631),p=n(84456),_=n(56560),A=n(10941);const M=1e-6,C=(0,u.vt)(),P=(0,u.vt)();function I(t,e,n,r,o,i,a,s,c,u){return function(t,e,n){let r=yt(t.maxVert[0],t.minVert[0]),o=0;for(let e=1;e<7;++e){const n=yt(t.maxVert[e],t.minVert[e]);n>r&&(r=n,o=e)}gt(e,t.minVert[o]),gt(n,t.maxVert[o])}(t,r,o),yt(r,o)<M?1:(lt(a,r,o),mt(a,a),function(t,e,n,r){const{data:o,size:i}=t;let a=Number.NEGATIVE_INFINITY,s=0;for(let t=0;t<o.length;t+=i){L[0]=o[t]-e[0],L[1]=o[t+1]-e[1],L[2]=o[t+2]-e[2];const r=n[0]*L[0]+n[1]*L[1]+n[2]*L[2],i=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=L[0]*L[0]+L[1]*L[1]+L[2]*L[2]-r*r/i;c>a&&(a=c,s=t)}return gt(r,o,s),a}(e,r,a,i)<M?2:(lt(s,o,i),mt(s,s),lt(c,i,r),mt(c,c),bt(n,s,a),mt(n,n),X(e,n,a,s,c,u),0))}const U=(0,u.vt)(),z=(0,u.vt)(),x=(0,u.vt)(),j=(0,u.vt)(),S=(0,u.vt)(),O=(0,u.vt)(),F=(0,u.vt)(),B=(0,u.vt)();function T(t,e,n,r,o,i,a,s,c){(function(t,e,n,r,o){!function(t,e,n,r,o){const{data:i,size:a}=t;gt(r,i),gt(o,r),n[0]=vt(H,e),n[1]=n[0];for(let t=a;t<i.length;t+=a){const a=i[t]*e[0]+i[t+1]*e[1]+i[t+2]*e[2];a<n[0]&&(n[0]=a,gt(r,i,t)),a>n[1]&&(n[1]=a,gt(o,i,t))}}(t,e,V,o,r);const i=vt(n,e);V[1]-M<=i&&(r[0]=void 0),V[0]+M>=i&&(o[0]=void 0)})(t,e,n,U,z),void 0!==U[0]&&(lt(x,U,n),mt(x,x),lt(j,U,r),mt(j,j),lt(S,U,o),mt(S,S),bt(O,j,i),mt(O,O),bt(F,S,a),mt(F,F),bt(B,x,s),mt(B,B),X(t,O,i,j,x,c),X(t,F,a,S,j,c),X(t,B,s,x,S,c)),void 0!==z[0]&&(lt(x,z,n),mt(x,x),lt(j,z,r),mt(j,j),lt(S,z,o),mt(S,S),bt(O,j,i),mt(O,O),bt(F,S,a),mt(F,F),bt(B,x,s),mt(B,B),X(t,O,i,j,x,c),X(t,F,a,S,j,c),X(t,B,s,x,S,c))}const L=[0,0,0],V=(0,_.vt)(),E=(0,u.vt)(),k=(0,u.vt)(),q=(0,u.vt)(),N=(0,u.vt)(),D=(0,u.vt)(),Y=(0,u.vt)();function X(t,e,n,r,o,i){if(wt(e)<M)return;bt(E,n,e),bt(k,r,e),bt(q,o,e),R(t,e,V),D[1]=V[0],N[1]=V[1],Y[1]=N[1]-D[1];const a=[n,r,o],s=[E,k,q];for(let n=0;n<3;++n){R(t,a[n],V),D[0]=V[0],N[0]=V[1],R(t,s[n],V),D[2]=V[0],N[2]=V[1],Y[0]=N[0]-D[0],Y[2]=N[2]-D[2];const r=ht(Y);r<i.quality&&(gt(i.b0,a[n]),gt(i.b1,e),gt(i.b2,s[n]),i.quality=r)}}const H=(0,u.vt)();function R(t,e,n){const{data:r,size:o}=t;n[0]=Number.POSITIVE_INFINITY,n[1]=Number.NEGATIVE_INFINITY;for(let t=0;t<r.length;t+=o){const o=r[t]*e[0]+r[t+1]*e[1]+r[t+2]*e[2];n[0]=Math.min(n[0],o),n[1]=Math.max(n[1],o)}}function Z(t,e,n){n.center=t,n.halfSize=(0,c.h)(e,e,.5),n.quaternion=s.zK}const Q=(0,u.vt)(),G=(0,u.vt)(),W=(0,u.vt)(),K=(0,u.vt)(),$=(0,u.vt)(),J=(0,u.vt)();function tt(t,e,n){gt(Q,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?Q[0]=0:Math.abs(e[1])>Math.abs(e[2])?Q[1]=0:Q[2]=0,wt(Q)<M&&(Q[0]=Q[1]=Q[2]=1),bt(G,e,Q),mt(G,G),bt(W,e,G),mt(W,W),et(t,e,G,W,K,$),lt(J,$,K),st(e,G,W,K,$,J,n)}function et(t,e,n,r,o,i){R(t,e,V),o[0]=V[0],i[0]=V[1],R(t,n,V),o[1]=V[0],i[1]=V[1],R(t,r,V),o[2]=V[0],i[2]=V[1]}const nt=(0,u.vt)(),rt=(0,u.vt)(),ot=(0,u.vt)(),it=(0,o.fA)(1,0,0,0,1,0,0,0,1),at=(0,s.vt)();function st(t,e,n,r,o,i,a){it[0]=t[0],it[1]=t[1],it[2]=t[2],it[3]=e[0],it[4]=e[1],it[5]=e[2],it[6]=n[0],it[7]=n[1],it[8]=n[2],a.quaternion=function(t,e){const n=e[0]+e[4]+e[8];if(n>0){let r=Math.sqrt(n+1);t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r}else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const r=(n+1)%3,o=(n+2)%3;let i=Math.sqrt(e[3*n+n]-e[3*r+r]-e[3*o+o]+1);t[n]=.5*i,i=.5/i,t[3]=(e[3*r+o]-e[3*o+r])*i,t[r]=(e[3*r+n]+e[3*n+r])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}(at,it),ft(nt,r,o),dt(nt,nt,.5),dt(rt,t,nt[0]),dt(ot,e,nt[1]),ft(rt,rt,ot),dt(ot,n,nt[2]),a.center=(0,c.g)(rt,rt,ot),a.halfSize=(0,c.h)(nt,i,.5)}class ct{constructor(t){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let e=0;this.minProj=new Float64Array(this.buffer,e,7),e+=56,this.maxProj=new Float64Array(this.buffer,e,7),e+=56;for(let t=0;t<7;++t)this.minVert[t]=new Float64Array(this.buffer,e,3),e+=24;for(let t=0;t<7;++t)this.maxVert[t]=new Float64Array(this.buffer,e,3),e+=24;for(let t=0;t<7;++t)this.minProj[t]=Number.POSITIVE_INFINITY,this.maxProj[t]=Number.NEGATIVE_INFINITY;const n=new Array(7),r=new Array(7),{data:o,size:i}=t;for(let t=0;t<o.length;t+=i){let e=o[t];e<this.minProj[0]&&(this.minProj[0]=e,n[0]=t),e>this.maxProj[0]&&(this.maxProj[0]=e,r[0]=t),e=o[t+1],e<this.minProj[1]&&(this.minProj[1]=e,n[1]=t),e>this.maxProj[1]&&(this.maxProj[1]=e,r[1]=t),e=o[t+2],e<this.minProj[2]&&(this.minProj[2]=e,n[2]=t),e>this.maxProj[2]&&(this.maxProj[2]=e,r[2]=t),e=o[t]+o[t+1]+o[t+2],e<this.minProj[3]&&(this.minProj[3]=e,n[3]=t),e>this.maxProj[3]&&(this.maxProj[3]=e,r[3]=t),e=o[t]+o[t+1]-o[t+2],e<this.minProj[4]&&(this.minProj[4]=e,n[4]=t),e>this.maxProj[4]&&(this.maxProj[4]=e,r[4]=t),e=o[t]-o[t+1]+o[t+2],e<this.minProj[5]&&(this.minProj[5]=e,n[5]=t),e>this.maxProj[5]&&(this.maxProj[5]=e,r[5]=t),e=o[t]-o[t+1]-o[t+2],e<this.minProj[6]&&(this.minProj[6]=e,n[6]=t),e>this.maxProj[6]&&(this.maxProj[6]=e,r[6]=t)}for(let t=0;t<7;++t){let e=n[t];gt(this.minVert[t],o,e),e=r[t],gt(this.maxVert[t],o,e)}}}class ut{constructor(){this.b0=(0,u.fA)(1,0,0),this.b1=(0,u.fA)(0,1,0),this.b2=(0,u.fA)(0,0,1),this.quality=0}}function ht(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function ft(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2]}function lt(t,e,n){t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2]}function dt(t,e,n){t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n}function gt(t,e,n=0){t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2]}function bt(t,e,n){const r=e[0],o=e[1],i=e[2],a=n[0],s=n[1],c=n[2];t[0]=o*c-i*s,t[1]=i*a-r*c,t[2]=r*s-o*a}function mt(t,e){const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(n>0){const r=1/Math.sqrt(n);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}}function wt(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function yt(t,e){const n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return n*n+r*r+o*o}function vt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}class pt{constructor(t=u.uY,e=Xt,n=s.zK){this._data=[t[0],t[1],t[2],e[0],e[1],e[2],n[0],n[1],n[2],n[3]]}clone(){const t=new pt;return t._data=this._data.slice(),t}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(t){const e=new pt;return e._data=t.slice(),e}static fromJSON(t){return new pt(t.center,t.halfSize,t.quaternion)}copy(t){this._data=t.data.slice()}get center(){return(0,c.s)(v.rq.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(t){return t[0]=this._data[0],t[1]=this._data[1],t[2]=this._data[2],t}set center(t){this._data[0]=t[0],this._data[1]=t[1],this._data[2]=t[2]}setCenter(t,e,n){this._data[0]=t,this._data[1]=e,this._data[2]=n}get halfSize(){return(0,c.s)(v.rq.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(t){return t[0]=this._data[3],t[1]=this._data[4],t[2]=this._data[5],t}set halfSize(t){this._data[3]=t[0],this._data[4]=t[1],this._data[5]=t[2]}get quaternion(){return(0,a.hZ)(v.J8.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(t){return t[0]=this._data[6],t[1]=this._data[7],t[2]=this._data[8],t[3]=this._data[9],t}set quaternion(t){this._data[6]=t[0],this._data[7]=t[1],this._data[8]=t[2],this._data[9]=t[3]}get data(){return this._data}getCorners(t){const e=_t,n=this._data;e[0]=n[6],e[1]=n[7],e[2]=n[8],e[3]=n[9];for(let r=0;r<8;++r){const o=t[r];o[0]=(1&r?-1:1)*n[3],o[1]=(2&r?-1:1)*n[4],o[2]=(4&r?-1:1)*n[5],(0,c.r)(o,o,e),o[0]+=n[0],o[1]+=n[1],o[2]+=n[2]}}isVisible(t){return this.intersectPlane(t[0])<=0&&this.intersectPlane(t[1])<=0&&this.intersectPlane(t[2])<=0&&this.intersectPlane(t[3])<=0&&this.intersectPlane(t[4])<=0&&this.intersectPlane(t[5])<=0}get radius(){const t=this._data[3],e=this._data[4],n=this._data[5];return Math.sqrt(t*t+e*e+n*n)}intersectSphere(t){Ct[0]=this._data[0]-t[0],Ct[1]=this._data[1]-t[1],Ct[2]=this._data[2]-t[2];const e=this.getQuaternion(At);return(0,a.Xr)(_t,e),(0,c.r)(Ct,Ct,_t),(0,c.u)(Ct,Ct),Pt[0]=Math.min(Ct[0],this._data[3]),Pt[1]=Math.min(Ct[1],this._data[4]),Pt[2]=Math.min(Ct[2],this._data[5]),(0,c.v)(Pt,Ct)<t[3]*t[3]}intersectSphereWithMBS(t,e=this.radius){const n=this._data;Ct[0]=n[0]-t[0],Ct[1]=n[1]-t[1],Ct[2]=n[2]-t[2];const r=t[3],o=r+e;return!((0,c.w)(Ct)>o*o)&&(_t[0]=-n[6],_t[1]=-n[7],_t[2]=-n[8],_t[3]=n[9],(0,c.r)(Ct,Ct,_t),(0,c.u)(Ct,Ct),Pt[0]=Math.min(Ct[0],n[3]),Pt[1]=Math.min(Ct[1],n[4]),Pt[2]=Math.min(Ct[2],n[5]),(0,c.v)(Pt,Ct)<r*r)}intersectPlane(t){const e=t[0]*this._data[0]+t[1]*this._data[1]+t[2]*this._data[2]+t[3],n=this.projectedRadius((0,w.Qj)(t));return e>n?1:e<-n?-1:0}intersectRay(t,e,n=0){const r=this._data,o=_t;o[0]=-r[6],o[1]=-r[7],o[2]=-r[8],o[3]=r[9],Ct[0]=t[0]-r[0],Ct[1]=t[1]-r[1],Ct[2]=t[2]-r[2];const i=(0,c.r)(Ct,Ct,_t),a=(0,c.r)(Pt,e,_t);let s=-1/0,u=1/0;const h=this.getHalfSize(Vt);for(let t=0;t<3;t++){const e=i[t],r=a[t],o=h[t]+n;if(Math.abs(r)>1e-6){const t=(o-e)/r,n=(-o-e)/r;s=Math.max(s,Math.min(t,n)),u=Math.min(u,Math.max(t,n))}else if(e>o||e<-o)return!1}return s<=u}projectedArea(t,e,n,o){const i=this.getQuaternion(At);(0,a.Xr)(_t,i),Ct[0]=t[0]-this._data[0],Ct[1]=t[1]-this._data[1],Ct[2]=t[2]-this._data[2],(0,c.r)(Ct,Ct,_t);const s=this.getHalfSize(Vt),u=Ct[0]<-s[0]?-1:Ct[0]>s[0]?1:0,f=Ct[1]<-s[1]?-1:Ct[1]>s[1]?1:0,l=Ct[2]<-s[2]?-1:Ct[2]>s[2]?1:0,d=Math.abs(u)+Math.abs(f)+Math.abs(l);if(0===d)return 1/0;const g=1===d?4:6,b=6*(u+3*f+9*l+13);(0,r.I0)(Et,i),(0,r.hs)(Et,Et,s);const m=this.getCenter(Tt);for(let t=0;t<g;t++){const n=xt[b+t];(0,c.s)(Ct,((1&n)<<1)-1,(2&n)-1,((4&n)>>1)-1),(0,c.t)(Ct,Ct,Et),(0,c.g)(It,m,Ct),It[3]=1,(0,h.t)(It,It,e);const r=1/Math.max(1e-6,It[3]);zt[2*t]=It[0]*r,zt[2*t+1]=It[1]*r}const w=2*g-2;let y=zt[0]*(zt[3]-zt[w+1])+zt[w]*(zt[1]-zt[w-1]);for(let t=2;t<w;t+=2)y+=zt[t]*(zt[t+3]-zt[t-1]);return Math.abs(y)*n*o*.125}projectedRadius(t){const e=this.getQuaternion(At);return(0,a.Xr)(_t,e),(0,c.r)(Ct,t,_t),Math.abs(Ct[0]*this._data[3])+Math.abs(Ct[1]*this._data[4])+Math.abs(Ct[2]*this._data[5])}minimumDistancePlane(t){return t[0]*this._data[0]+t[1]*this._data[1]+t[2]*this._data[2]+t[3]-this.projectedRadius((0,w.Qj)(t))}maximumDistancePlane(t){return t[0]*this._data[0]+t[1]*this._data[1]+t[2]*this._data[2]+t[3]+this.projectedRadius((0,w.Qj)(t))}toAaBoundingBox(t){const e=this.getQuaternion(At),n=(0,r.I0)(Et,e),o=this._data[3]*Math.abs(n[0])+this._data[4]*Math.abs(n[3])+this._data[5]*Math.abs(n[6]),i=this._data[3]*Math.abs(n[1])+this._data[4]*Math.abs(n[4])+this._data[5]*Math.abs(n[7]),a=this._data[3]*Math.abs(n[2])+this._data[4]*Math.abs(n[5])+this._data[5]*Math.abs(n[8]);t[0]=this._data[0]-o,t[1]=this._data[1]-i,t[2]=this._data[2]-a,t[3]=this._data[0]+o,t[4]=this._data[1]+i,t[5]=this._data[2]+a}transform(t,e,n,r=0,o=(0,d.lO)(n),i=(0,d.lO)(e),s=(0,m.jd)(e,i)){if(n===o)e.isGeographic?function(t,e,n,r,o=(0,d.lO)(n)){const i=(0,l.tO)(n),s=1+Math.max(0,r)/(i.radius+t.centerZ);t.getCenter(Bt),Bt[2]+=r,(0,b.projectBuffer)(Bt,n,0,Bt,o,0,1),e.center=Bt;const u=t.getQuaternion(At);e.quaternion=u,(0,a.Xr)(_t,u),(0,c.s)(Nt,0,0,1),(0,c.r)(Nt,Nt,_t);const h=t.getHalfSize(Vt);(0,c.s)(Nt,h[0]*Math.abs(Nt[0]),h[1]*Math.abs(Nt[1]),h[2]*Math.abs(Nt[2])),(0,c.h)(Nt,Nt,i.inverseFlattening),(0,c.g)(Nt,h,Nt),e.halfSize=(0,c.h)(Nt,Nt,s)}(this,t,e,r,i):function(t,e,n,r,o=(0,d.lO)(n),i=(0,m.jd)(n,o)){t.getCorners(qt),t.getCenter(Bt),Bt[2]+=r,(0,g.l)(n,Bt,kt,o),e.setCenter(kt[12],kt[13],kt[14]);const s=2*Math.sqrt(1+kt[0]+kt[5]+kt[10]);_t[0]=(kt[6]-kt[9])/s,_t[1]=(kt[8]-kt[2])/s,_t[2]=(kt[1]-kt[4])/s,_t[3]=.25*s;const u=t.getQuaternion(At);e.quaternion=(0,a.lw)(_t,_t,u),(0,a.Xr)(_t,_t),(0,c.s)(Dt,0,0,0);const h=e.getCenter(Lt);for(const t of qt)t[2]+=r,i(t,0,t,0),(0,c.y)(Nt,t,h),(0,c.r)(Nt,Nt,_t),(0,c.u)(Nt,Nt),(0,c.B)(Dt,Dt,Nt);e.halfSize=Dt}(this,t,e,r,i,s);else if(e.isWGS84&&(n.isWebMercator||(0,y.r1)(n)))!function(t,e,n,r,o){e.getCenter(Tt),Tt[2]+=o;const i=(0,d.lO)(n);(0,b.projectBuffer)(Tt,t,0,Tt,i,0,1),St(i,e,Tt,n,r)}(e,this,n,t,r);else if(e.isWebMercator&&(0,y.r1)(n))!function(t,e,n,r,o){e.getCenter(Tt),Tt[2]+=o,St(t,e,Tt,n,r)}(e,this,n,t,r);else{const o=this.getCenter(Tt);o[2]+=r,(0,b.projectBuffer)(o,e,0,o,n,0,1),t.center=o,this!==t&&(t.quaternion=this.getQuaternion(At),t.halfSize=this.getHalfSize(Vt))}}}const _t=(0,s.vt)(),At=(0,s.vt)(),Mt=(0,s.vt)(),Ct=(0,u.vt)(),Pt=(0,u.vt)(),It=(0,f.vt)();function Ut(t,e=new pt){return function(t,e){const{data:n,size:r}=t,o=n.length/r;if(o<=0)return;const i=new ct(t);ft(C,i.minProj,i.maxProj),dt(C,C,.5),lt(P,i.maxProj,i.minProj);const a=ht(P),s=new ut;s.quality=a,o<14&&(t=new A.K(new Float64Array(i.buffer,112,42),3));const c=(0,u.vt)(),h=(0,u.vt)(),f=(0,u.vt)(),l=(0,u.vt)(),d=(0,u.vt)(),g=(0,u.vt)(),b=(0,u.vt)();switch(I(i,t,b,c,h,f,l,d,g,s)){case 1:return void Z(C,P,e);case 2:return void tt(t,l,e)}T(t,b,c,h,f,l,d,g,s),et(t,s.b0,s.b1,s.b2,K,$);const m=(0,u.vt)();lt(m,$,K),s.quality=ht(m),s.quality<a?st(s.b0,s.b1,s.b2,K,$,m,e):Z(C,P,e)}(t,e),e}const zt=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],xt=(()=>{const t=new Int8Array(162);let e=0;const n=n=>{for(let r=0;r<n.length;r++)t[e+r]=n[r];e+=6};return n([6,2,3,1,5,4]),n([0,2,3,1,5,4]),n([0,2,3,7,5,4]),n([0,1,3,2,6,4]),n([0,1,3,2,0,0]),n([0,1,5,7,3,2]),n([0,1,3,7,6,4]),n([0,1,3,7,6,2]),n([0,1,5,7,6,2]),n([0,1,5,4,6,2]),n([0,1,5,4,0,0]),n([0,1,3,7,5,4]),n([0,2,6,4,0,0]),n([0,0,0,0,0,0]),n([1,3,7,5,0,0]),n([2,3,7,6,4,0]),n([2,3,7,6,0,0]),n([2,3,1,5,7,6]),n([0,1,5,7,6,2]),n([0,1,5,7,6,4]),n([0,1,3,7,6,4]),n([4,5,7,6,2,0]),n([4,5,7,6,0,0]),n([4,5,1,3,7,6]),n([0,2,3,7,5,4]),n([6,2,3,7,5,4]),n([6,2,3,1,5,4]),t})();function jt(t,e,n,r,o){const i=t.getQuaternion(At);o.quaternion=i,(0,a.Xr)(_t,i);const s=t.getCenter(Tt),h=t.getHalfSize(Vt);if(r===p.RT.Global){(0,c.r)(Nt,s,_t),(0,c.u)(Dt,Nt),(0,c.x)(Yt,Dt,h),(0,c.y)(Yt,Dt,Yt);const r=(0,c.l)(Yt);(0,c.g)(Yt,Dt,h);const i=(0,c.l)(Yt);if(r<n)o.center=s,(0,c.s)(Nt,n,n,n),o.halfSize=(0,c.g)(Nt,h,Nt);else{const a=i>0?1+e/i:1,s=r>0?1+n/r:1,u=(s+a)/2,f=(s-a)/2;(0,c.h)(Yt,Dt,f),o.halfSize=(0,c.q)(Yt,Yt,h,u),(0,c.h)(Yt,Dt,u),(0,c.q)(Yt,Yt,h,f),(0,c.z)(Nt,Nt),(0,c.A)(Nt,Yt,Nt);const l=t.getQuaternion(Mt);o.center=(0,c.r)(Nt,Nt,l)}}else{o.center=(0,c.q)(Nt,s,u.Cb,(n+e)/2);const t=(0,c.r)(Nt,u.Cb,_t);(0,c.u)(t,t),o.halfSize=(0,c.q)(Dt,h,t,(n-e)/2)}return o}function St(t,e,n,o,i){const a=e.getQuaternion(At),s=(0,r.I0)(Et,a),c=e.getHalfSize(Vt);for(let t=0;t<8;++t){for(let e=0;e<3;++e)Bt[e]=c[e]*(0!=(t&1<<e)?-1:1);for(let e=0;e<3;++e){let r=n[e];for(let t=0;t<3;++t)r+=Bt[t]*s[3*t+e];Ot[3*t+e]=r}}(0,b.projectBuffer)(Ot,t,0,Ot,o,0,8),Ut(Ft,i)}const Ot=new Array(24),Ft=new A.K(Ot,3),Bt=(0,u.vt)(),Tt=(0,u.vt)(),Lt=(0,u.vt)(),Vt=(0,u.vt)(),Et=(0,o.vt)(),kt=(0,i.vt)(),qt=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Nt=(0,u.vt)(),Dt=(0,u.vt)(),Yt=(0,u.vt)(),Xt=(0,u.fA)(-1,-1,-1)}}]);