"use strict";(self.webpackChunkmadaster_typescript=self.webpackChunkmadaster_typescript||[]).push([[5506],{20472:(t,e,r)=>{r.d(e,{F:()=>c,l:()=>u});var i=r(44764),n=r(6273);const s=128e3;let o=null,a=null;async function c(){return o||(o=async function(){const t=(0,n.A)("esri-csp-restrictions")?await r.e(2512).then(r.bind(r,62512)).then((t=>t.l)):await r.e(4250).then(r.bind(r,74250)).then((t=>t.l));a=await t.default({locateFile:t=>(0,i.s)(`esri/core/libs/libtess/${t}`)})}()),o}function u(t,e){const r=Math.max(t.length,s);return a.triangulate(t,e,r)}},61866:(t,e,r)=>{r.d(e,{$:()=>i,s:()=>n});const i=15.5,n=1024},92524:(t,e,r)=>{r.d(e,{V:()=>c});var i=r(52266),n=r(54481),s=r(19388),o=r(32199),a=r(52644);class c{static executeEffects(t,e,r,i){const n=(0,a.ll)(t);let c=new s.k(e);for(const e of t){const t=(0,o.A)(e);t&&(c=t.execute(c,e,1.3333333333333333,r,i,n))}return c}static applyEffects(t,e,r){if(!t)return e;const c=(0,a.ll)(t);let u,l=new s.k(i.z.fromJSONCIM(e));for(const e of t){const t=(0,o.A)(e);t&&(l=t.execute(l,e,1,null,r,c))}const h=[];let d=null;for(;u=l.next();)h.push(...(0,n.x)(u)),d=u.geometryType;return 0===h.length||null===d?null:"esriGeometryPolygon"===d?{rings:h}:{paths:h}}}},31927:(t,e,r)=>{r.d(e,{KQ:()=>i,Q4:()=>s,Ss:()=>o});const i=8388607,n=8388608,s=t=>t&i;function o(t,e){return((e?n:0)|t)>>>0}},73274:(t,e,r)=>{r.d(e,{i:()=>f});var i=r(85953),n=r(6538);function s(t,e){return t.x===e.x&&t.y===e.y}function o(t){if(!t)return;const e=t.length;if(e<=1)return;let r=0;for(let i=1;i<e;i++)s(t[i],t[r])||++r===i||(t[r]=t[i]);t.length=r+1}function a(t,e){return t.x=e.y,t.y=-e.x,t}function c(t,e){return t.x=-e.y,t.y=e.x,t}function u(t,e){return t.x=e.x,t.y=e.y,t}function l(t,e){return t.x=-e.x,t.y=-e.y,t}function h(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function d(t,e){return t.x*e.x+t.y*e.y}function p(t,e,r,i){return t.x=e.x*r+e.y*i,t.y=e.x*i-e.y*r,t}class f{constructor(t,e,r){this._writeVertex=t,this._writeTriangle=e,this._canUseThinTessellation=r,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(t,e,r=this._canUseThinTessellation){o(t),r&&e.halfWidth<n.Gh&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)}_tessellateThin(t,e){if(t.length<2)return;const r=e.wrapDistance||65535;let i=e.initialDistance||0,n=!1,s=t[0].x,o=t[0].y;const a=t.length;for(let e=1;e<a;++e){n&&(n=!1,i=0);let a=t[e].x,c=t[e].y,u=a-s,l=c-o,h=Math.sqrt(u*u+l*l);if(u/=h,l/=h,i+h>r){n=!0;const t=(r-i)/h;h=r-i,a=(1-t)*s+t*a,c=(1-t)*o+t*c,--e}const d=this._writeVertex(s,o,0,0,u,l,l,-u,0,-1,i),p=this._writeVertex(s,o,0,0,u,l,-l,u,0,1,i);i+=h;const f=this._writeVertex(a,c,0,0,u,l,l,-u,0,-1,i),y=this._writeVertex(a,c,0,0,u,l,-l,u,0,1,i);this._writeTriangle(d,p,f),this._writeTriangle(p,f,y),s=a,o=c}}_tessellate(t,e){const r=t[0],n=t[t.length-1],o=s(r,n),f=o?3:2;if(t.length<f)return;const y=e.pixelCoordRatio,x=null!=e.capType?e.capType:i.xR.BUTT,m=null!=e.joinType?e.joinType:i.JO.MITER,g=null!=e.miterLimit?Math.min(e.miterLimit,4):2,_=null!=e.roundLimit?Math.min(e.roundLimit,1.05):1.05,v=null!=e.halfWidth?e.halfWidth:2,b=!!e.textured;let w,S,P,M=null;const T=this._prevNormal,k=this._nextNormal;let I=-1,z=-1;const N=this._joinNormal;let E,A;const C=this._textureNormalLeft,F=this._textureNormalRight,L=this._textureNormal;let D=-1,V=-1;const B=e.wrapDistance||65535;let R=e.initialDistance||0;const O=this._writeVertex,$=this._writeTriangle,U=(t,e,r,i,n,s)=>{const o=O(S,P,E,A,r,i,t,e,n,s,R);return D>=0&&V>=0&&o>=0&&$(D,V,o),D=V,V=o,o};o&&(w=t[t.length-2],k.x=n.x-w.x,k.y=n.y-w.y,z=h(k),k.x/=z,k.y/=z);let Y=!1;for(let e=0;e<t.length;++e){if(Y&&(Y=!1,R=0),w&&(T.x=-k.x,T.y=-k.y,I=z,R+I>B&&(Y=!0)),Y){const r=(B-R)/I;I=B-R,w={x:(1-r)*w.x+r*t[e].x,y:(1-r)*w.y+r*t[e].y},--e}else w=t[e];S=w.x,P=w.y;const r=e<=0&&!Y,n=e===t.length-1;if(r||(R+=I),M=n?o?t[1]:null:t[e+1],M?(k.x=M.x-S,k.y=M.y-P,z=h(k),k.x/=z,k.y/=z):(k.x=void 0,k.y=void 0),!o){if(r){c(N,k),E=N.x,A=N.y,x===i.xR.SQUARE&&(U(-k.y-k.x,k.x-k.y,k.x,k.y,0,-1),U(k.y-k.x,-k.x-k.y,k.x,k.y,0,1)),x===i.xR.ROUND&&(U(-k.y-k.x,k.x-k.y,k.x,k.y,-1,-1),U(k.y-k.x,-k.x-k.y,k.x,k.y,-1,1)),x!==i.xR.ROUND&&x!==i.xR.BUTT||(U(-k.y,k.x,k.x,k.y,0,-1),U(k.y,-k.x,k.x,k.y,0,1));continue}if(n){a(N,T),E=N.x,A=N.y,x!==i.xR.ROUND&&x!==i.xR.BUTT||(U(T.y,-T.x,-T.x,-T.y,0,-1),U(-T.y,T.x,-T.x,-T.y,0,1)),x===i.xR.SQUARE&&(U(T.y-T.x,-T.x-T.y,-T.x,-T.y,0,-1),U(-T.y-T.x,T.x-T.y,-T.x,-T.y,0,1)),x===i.xR.ROUND&&(U(T.y-T.x,-T.x-T.y,-T.x,-T.y,1,-1),U(-T.y-T.x,T.x-T.y,-T.x,-T.y,1,1));continue}}let s,f,O=(Z=k,-((G=T).x*Z.y-G.y*Z.x));if(Math.abs(O)<.01)d(T,k)>0?(N.x=T.x,N.y=T.y,O=1,s=Number.MAX_VALUE,f=!0):(c(N,k),O=1,s=1,f=!1);else{N.x=(T.x+k.x)/O,N.y=(T.y+k.y)/O,s=h(N);const t=(s-1)*v*y;f=s>4||t>I&&t>z}E=N.x,A=N.y;let $=m;switch(m){case i.JO.BEVEL:s<1.05&&($=i.JO.MITER);break;case i.JO.ROUND:s<_&&($=i.JO.MITER);break;case i.JO.MITER:s>g&&($=i.JO.BEVEL)}switch($){case i.JO.MITER:if(U(N.x,N.y,-T.x,-T.y,0,-1),U(-N.x,-N.y,-T.x,-T.y,0,1),n)break;if(b){const t=Y?0:R;D=this._writeVertex(S,P,E,A,k.x,k.y,N.x,N.y,0,-1,t),V=this._writeVertex(S,P,E,A,k.x,k.y,-N.x,-N.y,0,1,t)}break;case i.JO.BEVEL:{const t=O<0;let e,r,i,s;if(t){const t=D;D=V,V=t,e=C,r=F}else e=F,r=C;if(f)i=t?c(this._innerPrev,T):a(this._innerPrev,T),s=t?a(this._innerNext,k):c(this._innerNext,k);else{const e=t?l(this._inner,N):u(this._inner,N);i=e,s=e}const o=t?a(this._bevelStart,T):c(this._bevelStart,T);U(i.x,i.y,-T.x,-T.y,e.x,e.y);const h=U(o.x,o.y,-T.x,-T.y,r.x,r.y);if(n)break;const d=t?c(this._bevelEnd,k):a(this._bevelEnd,k);if(f){const t=this._writeVertex(S,P,E,A,-T.x,-T.y,0,0,0,0,R);D=this._writeVertex(S,P,E,A,k.x,k.y,s.x,s.y,e.x,e.y,R),V=this._writeVertex(S,P,E,A,k.x,k.y,d.x,d.y,r.x,r.y,R),this._writeTriangle(h,t,V)}else{if(b){const t=this._bevelMiddle;t.x=(o.x+d.x)/2,t.y=(o.y+d.y)/2,p(L,t,-T.x,-T.y),U(t.x,t.y,-T.x,-T.y,L.x,L.y),p(L,t,k.x,k.y),D=this._writeVertex(S,P,E,A,k.x,k.y,t.x,t.y,L.x,L.y,R),V=this._writeVertex(S,P,E,A,k.x,k.y,s.x,s.y,e.x,e.y,R)}else{const t=D;D=V,V=t}U(d.x,d.y,k.x,k.y,r.x,r.y)}if(t){const t=D;D=V,V=t}break}case i.JO.ROUND:{const t=O<0;let e,r;if(t){const t=D;D=V,V=t,e=C,r=F}else e=F,r=C;const i=t?l(this._inner,N):u(this._inner,N);let o,h;f?(o=t?c(this._innerPrev,T):a(this._innerPrev,T),h=t?a(this._innerNext,k):c(this._innerNext,k)):(o=i,h=i);const y=t?a(this._roundStart,T):c(this._roundStart,T),x=t?c(this._roundEnd,k):a(this._roundEnd,k),m=U(o.x,o.y,-T.x,-T.y,e.x,e.y),g=U(y.x,y.y,-T.x,-T.y,r.x,r.y);if(n)break;const _=this._writeVertex(S,P,E,A,-T.x,-T.y,0,0,0,0,R);f||this._writeTriangle(D,V,_);const v=l(this._outer,i),w=this._writeVertex(S,P,E,A,k.x,k.y,x.x,x.y,r.x,r.y,R);let M,I;const z=s>2;if(z){let e;s!==Number.MAX_VALUE?(v.x/=s,v.y/=s,e=d(T,v),e=(s*(e*e-1)+1)/e):e=-1,M=t?a(this._startBreak,T):c(this._startBreak,T),M.x+=T.x*e,M.y+=T.y*e,I=t?c(this._endBreak,k):a(this._endBreak,k),I.x+=k.x*e,I.y+=k.y*e}p(L,v,-T.x,-T.y);const B=this._writeVertex(S,P,E,A,-T.x,-T.y,v.x,v.y,L.x,L.y,R);p(L,v,k.x,k.y);const $=b?this._writeVertex(S,P,E,A,k.x,k.y,v.x,v.y,L.x,L.y,R):B,Y=_,G=b?this._writeVertex(S,P,E,A,k.x,k.y,0,0,0,0,R):_;let Z=-1,W=-1;if(z&&(p(L,M,-T.x,-T.y),Z=this._writeVertex(S,P,E,A,-T.x,-T.y,M.x,M.y,L.x,L.y,R),p(L,I,k.x,k.y),W=this._writeVertex(S,P,E,A,k.x,k.y,I.x,I.y,L.x,L.y,R)),b?z?(this._writeTriangle(Y,g,Z),this._writeTriangle(Y,Z,B),this._writeTriangle(G,$,W),this._writeTriangle(G,W,w)):(this._writeTriangle(Y,g,B),this._writeTriangle(G,$,w)):z?(this._writeTriangle(_,g,Z),this._writeTriangle(_,Z,W),this._writeTriangle(_,W,w)):(this._writeTriangle(_,g,B),this._writeTriangle(_,$,w)),f?(D=this._writeVertex(S,P,E,A,k.x,k.y,h.x,h.y,e.x,e.y,R),V=w):(D=b?this._writeVertex(S,P,E,A,k.x,k.y,h.x,h.y,e.x,e.y,R):m,this._writeTriangle(D,G,w),V=w),t){const t=D;D=V,V=t}break}}}var G,Z}}},37614:(t,e,r)=>{r.d(e,{Y7:()=>B,HS:()=>R,mm:()=>O,A:()=>U,k2:()=>$,ZA:()=>V,E8:()=>L,hF:()=>A,C5:()=>E,uK:()=>F,Pi:()=>C});var i=r(82392),n=r(3223),s=r(80861),o=r(21332),a=r(62991),c=r(34088),u=r(26421);const l=()=>s.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class h{constructor(){this._includedModules=new Map}include(t,e){if(this._includedModules.has(t)){const r=this._includedModules.get(t);if(r!==e){l().error("Trying to include shader module multiple times with different sets of options.");const e=new Set;for(const i of Object.keys(r))r[i]!==t[i]&&e.add(i);for(const i of Object.keys(t))r[i]!==t[i]&&e.add(i);e.forEach((e=>console.error(`  ${e}: current ${r[e]} new ${t[e]}`)))}}else this._includedModules.set(t,e),t(this.builder,e)}}class d extends h{constructor(){super(...arguments),this.vertex=new y,this.fragment=new y,this.attributes=new x,this.varyings=new m,this.extensions=new g,this.constants=new _}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(t,e=!0){const r=this.extensions.generateSource(t),i=this.attributes.generateSource(t),n=this.varyings.generateSource(t),s="vertex"===t?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),c="vertex"===t?v:function(t=!0){return`#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif\n${t?"out vec4 fragColor;":""}\n`}(e),u=this.constants.generateSource().concat(s.constants.generateSource());return`${e?"#version 300 es":""}\n${r.join("\n")}\n${c}\n${u.join("\n")}\n${o.join("\n")}\n${i.join("\n")}\n${n.join("\n")}\n${a.join("\n")}`}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const r=t.bind[c.c.Pass];r&&e.set(t.name,r)})),this.fragment.uniforms.entries.forEach((t=>{const r=t.bind[c.c.Pass];r&&e.set(t.name,r)}));const r=Array.from(e.values()),i=r.length;return(e,n)=>{for(let s=0;s<i;++s)r[s](t,e,n)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach((t=>{const r=t.bind[c.c.Draw];r&&e.set(t.name,r)})),this.fragment.uniforms.entries.forEach((t=>{const r=t.bind[c.c.Draw];r&&e.set(t.name,r)}));const r=Array.from(e.values()),i=r.length;return(e,n,s)=>{for(let o=0;o<i;++o)r[o](t,e,n,s)}}}class p{constructor(){this._entries=new Map}add(...t){for(const e of t)this._add(e)}get(t){return this._entries.get(t)}_add(t){if(null!=t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new a.A(`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else l().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map((t=>null!=t.arraySize?`uniform ${t.type} ${t.name}[${t.arraySize}];`:`uniform ${t.type} ${t.name};`))}get entries(){return Array.from(this._entries.values())}}class f{constructor(){this._entries=new Array}add(t){this._entries.push(t)}generateSource(){return this._entries}}class y extends h{constructor(){super(...arguments),this.uniforms=new p,this.code=new f,this.constants=new _}get builder(){return this}}class x{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map((t=>`in ${t[1]} ${t[0]};`))}}class m{constructor(){this._entries=new Map}add(t,e){this._entries.has(t)&&(0,u.vA)(this._entries.get(t)===e),this._entries.set(t,e)}generateSource(t){const e=new Array;return this._entries.forEach(((r,i)=>e.push("vertex"===t?`out ${r} ${i};`:`in ${r} ${i};`))),e}}class g{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?g.ALLOWLIST_VERTEX:g.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter((t=>e.includes(t))).map((t=>`#extension ${t} : enable`))}}g.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],g.ALLOWLIST_VERTEX=[];class _{constructor(){this._entries=new Set}add(t,e,r){let i="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":i=_._numberToFloatStr(r);break;case"int":i=_._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${_._numberToFloatStr(r[0])},                            ${_._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${_._numberToFloatStr(r[0])},                            ${_._numberToFloatStr(r[1])},                            ${_._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${_._numberToFloatStr(r[0])},                            ${_._numberToFloatStr(r[1])},                            ${_._numberToFloatStr(r[2])},                            ${_._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${_._numberToIntStr(r[0])},                             ${_._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${_._numberToIntStr(r[0])},                             ${_._numberToIntStr(r[1])},                             ${_._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${_._numberToIntStr(r[0])},                             ${_._numberToIntStr(r[1])},                             ${_._numberToIntStr(r[2])},                             ${_._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${e}(${Array.prototype.map.call(r,(t=>_._numberToFloatStr(t))).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${i};`),this}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const v="precision highp float;\nprecision highp sampler2D;";var b=r(15871);function w(t,e,r){const i=e.split("\n");for(const e of i)if(e.trim().length){{let e="";null!=r&&(e+=`/*id:${r??"000"}*/   `),t.body+=e.padEnd(14)}t.body+=" ".repeat(t.indent)+e+"\n"}}class S{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let r="";return"boolean"!=typeof e&&"number"!=typeof e&&e.debugInfo.name&&(r=`${e.debugInfo.name}_`),`${r}v${t.varCount++}`}_write(t,e,r=!1){if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e.toString();let i=t.getEmit(e);if(i)return i;switch(e.shaderType){case"scope-node":i=this._writeScopeNode(t,e);break;case"primitive-node":i=this._writePrimitveNode(t,e,r);break;case"function-node":i=this._writeFunctionNode(t,e);break;case"property-access-node":i=this._writePropertyAccessNode(t,e);break;case"text-node":i=e.text;break;case"block-node":i=this._writeBlockNode(t,e);break;case"condition-node":i=this._writeConditionNode(t,e)}return t.setEmit(e,i),i}_writeScopeNode(t,e){const r=new e.child.constructor;r.setDebugName(e.debugInfo.name);const i=this._write(t,r,!0);return w(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,w(t,`${i} = ${this._write(t,e.child)};`),t.indent-=2,w(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),i}_writeConditionNode(t,e){const r=new e.ifTrue.constructor,i=this._write(t,r,!0);w(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const n=t.createSubgraphContext(),s=this._write(n,e.ifTrue);if(t.body+=n.body,s&&w(t,`${i} = ${s};`),t.indent-=2,w(t,"}"),e.ifFalse){w(t,"else {"),t.indent+=2;const r=t.createSubgraphContext(),n=this._write(r,e.ifFalse);t.body+=r.body,n&&w(t,`${i} = ${n};`),t.indent-=2,w(t,"}")}return i}_writeBlockNode(t,e){const{captureList:r,generator:i,returnType:n}=e,s={};for(const e in r){if(!r[e])continue;const i=this._write(t,r[e]);s[e]=i}const o=new n,a=this._write(t,o,!0);if(s.out=a,e.subgraph){const r=t.createSubgraphContext(),i=this._write(r,e.subgraph.child),n=r.body;s.subgraph={varName:i,body:n}}const c=i(s);return w(t,"{\n"),t.indent+=2,w(t,c),t.indent-=2,w(t,"}\n"),a}_writePropertyAccessNode(t,e){const r=this._write(t,e.target);return"string"==typeof e.property&&e.property.includes("[")?`${r}${e.property}`:"string"!=typeof e.property?`${r}[${this._write(t,e.property)}]`:`${r}.${e.property}`}_writeFunctionNode(t,e){const r=e.returnType.type;if(e.isInfix){const[i,n]=e.children.map((e=>this._write(t,e))),s=this._createVarName(t,e);return w(t,`${r.padEnd(5)} ${s} = ${i} ${e.token} ${n};`,e.uid),s}const i=e.children.map((e=>this._write(t,e))).join(", "),n=this._createVarName(t,e);return w(t,`${r.padEnd(5)} ${n} = ${e.token}(${i});`,e.uid),n}_writePrimitveNode(t,e,r=!1){const i=t.getInput(e);if(i)return i.isUsed=!0,i.variableName;const n=1===e.children.length&&e.children[0]?.type===e.type;if(e.isImplicit||n)return this._write(t,e.children[0]);const s=this._createVarName(t,e);if(r)return w(t,`${e.type.padEnd(5)} ${s};`,e.uid),s;const o=!e.debugInfo.name&&!e.isMutable;if(o&&"float"===e.type&&"number"==typeof e.children[0])return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(o&&"int"===e.type&&"number"==typeof e.children[0]&&Number.isInteger(e.children[0]))return e.children[0].toString();const a=e.children.map((e=>this._write(t,e))).join(", ");return"array"===e.type?(w(t,`${e.type.padEnd(5)} ${s} = [${a}];`,e.uid),s):o?`${e.type}(${a})`:(w(t,`${e.type.padEnd(5)} ${s} = ${e.type}(${a});`,e.uid),s)}}var P=r(82484);class M{constructor(t,e,r){this.variableName=t,this.variableInputType=e,this.node=r,this.type="shader-input",this.isUsed=!1}clone(){return new M(this.variableName,this.variableInputType,(0,P.vA)(this.node))}}class T{constructor(t,e,r){this.outVariableName=t,this.outVariableType=e,this.node=r,this.type="shader-output"}clone(){const t=new T(this.outVariableName,this.outVariableType,(0,P.vA)(this.node));return t.variableName=this.variableName,t}}class k{static createVertex(t,e,r,i,n,s){const o=[];for(const e in t){const i=t[e],n=r.get(e);n?o.push(new M(n,"builtin",i)):o.push(new M("a_"+e,"attribute",i))}for(const t of i){const e=t.uniformHydrated;o.push(new M(t.uniformName,"uniform",e))}const a=[];for(const t in e){const r=e[t];"glPosition"===t?a.push(new T("gl_Position","builtin",r)):"glPointSize"===t?a.push(new T("gl_PointSize","builtin",r)):a.push(new T("v_"+t,"varying",r))}return new k(o,a,n,s)}static createFragment(t,e,r,i,n,s){const o=[],a=Array.from(n.rootOutputNodes());for(const e in t){const i=t[e],n=r.get(e);if(n){o.push(new M(n,"builtin",i));continue}const s=a.find((t=>t.node===i));s&&o.push(new M(s.outVariableName,s.outVariableType,i))}for(const t of i){const e=t.uniformHydrated;o.push(new M(t.uniformName,"uniform",e))}const c=[];for(const t in e){const i=e[t],n=r.get(t);if("discard"===t)c.push(new T(null,"discard",i));else{if(!n)throw new Error(`Member ${t} in shader fragment output shoule be tagged as builtin`);c.push(new T(n,"builtin",i))}}return new k(o,c,s)}constructor(t,e,r,i){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const e of t)this._inputShaderTypesByNodeUid.set(e.node.uid,e);this._outputShaderTypes=e,this._transformFeedbackBindings=r,this._transformFeedbackNames=new Set(r.map((t=>"v_"+t.propertyKey))),this._usedInFragmentShader=i}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&"builtin"!==t.outVariableType&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();"number"!=typeof e&&"boolean"!=typeof e&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())"number"!=typeof t&&"boolean"!=typeof t&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new k([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const r="builtin"===e.outVariableType;this.shouldPruneOutputNode(e)||(r?t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`):t.vertex.code.add(`${e.outVariableType.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`))}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())"discard"===e.outVariableType?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${e.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const r of this.inputs())r.isUsed&&"builtin"!==r.variableInputType&&("array"===r.node.type?t[e].code.add(`${r.variableInputType.padEnd(10)} ${r.node.elementType.type.padEnd(9)} ${r.variableName}[${r.node.size}];`):t[e].code.add(`${r.variableInputType.padEnd(10)} ${r.node.type.padEnd(9)} ${r.variableName};`))}}var I=r(84472);function z(t){return new t}function N(t,e,r){const i=t.constructor[e]??[];t.constructor.hasOwnProperty(e)||Object.defineProperty(t.constructor,e,{value:i.slice()}),t.constructor[e].push(r)}function E(t,e){return(r,i)=>{N(r,"locations",{typeCtor:e,propertyKey:i,parameterIndex:null,index:t})}}const A=t=>(e,r,i)=>{N(e,"inputs",{inputCtor:t,propertyKey:r,parameterIndex:i})},C=t=>(e,r)=>{N(e,"uniforms",{typeCtor:t,propertyKey:r})},F=t=>(e,r)=>{N(e,"options",{typeCtor:t,propertyKey:r})},L=(t,e)=>{N(t,"defines",{propertyKey:e})},D=(t,e)=>(r,i)=>{r.constructor.builtins.push({builtin:t,propertyKey:i,typeCtor:e})};class V{}V.builtins=[],(0,i._)([D("gl_VertexID",b.Ai)],V.prototype,"glVertexID",void 0);class B{}class R{}R.builtins=[],(0,i._)([D("gl_FragCoord",b.Zb)],R.prototype,"glFragCoord",void 0),(0,i._)([D("gl_PointCoord",b.ZY)],R.prototype,"glPointCoord",void 0);class O{}(0,i._)([(t,e)=>{N(t,"builtins",{builtin:"gl_FragColor",propertyKey:e})}],O.prototype,"glFragColor",void 0);class ${constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class U{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=(0,n.Uk)(this._shaderModuleClass.inputs,(t=>"vertex"===t.propertyKey&&0===t.parameterIndex));if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return(0,n.Uk)(this._shaderModuleClass.inputs,(t=>"vertex"===t.propertyKey&&1===t.parameterIndex))}get fragmentInput(){const t=(0,n.Uk)(this._shaderModuleClass.inputs,(t=>"fragment"===t.propertyKey));if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const t=new Map,e=new Set;for(const r of this.locations)e.has(r.index)?s.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${r.propertyKey} to ${r.index}. Index already in use`,{locationsMap:t}):(t.set(r.propertyKey,r.index),e.add(r.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map((([t,e])=>`${t}.${e}`)).join("."),r=(0,o.Wm)(e);this._locationInfo={hash:r,locations:t}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,r,i){try{const{vertex:n,fragment:s,uniformBindings:o}=this._generateShaders(t,e,r,i);return new I.K(n,s,this.renamedLocationsMap,this.locationInfo,o,this.transformFeedbackBindings)}catch(t){return console.error("Failed to create program",{error:t}),new I.K("","",this.renamedLocationsMap,this.locationInfo,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find((e=>e.propertyKey===t));if(e)return{type:"option",className:e.typeCtor};const r=this._uniforms.find((e=>e.propertyKey===t));if(!r)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:r.typeCtor}}getShaderKey(t,e,r,i){const n=Object.keys(r).map((t=>`${t}.${r[t]}`)).join("."),s=Object.keys(i).map((t=>`${t}.${i[t]}`)).join("."),o=Object.keys(e).filter((t=>this.optionPropertyKeys.has(t)&&e[t])).join(".");return`${this.constructor.name}.${t.hash}.${n}.${s}.${o}`}_generateShaders(t,e,r,i){const n=[];this._setDefines(r),this._setOptionalUniforms(n,e),this._setRequiredUniforms(n);const s=this._hydrateVertexInput(i),o=this._injectPackPrecisionFactor(s,t),a=this._hydrateComputeInput(),c=a&&this._injectPackPrecisionFactor(a,t),u=this.vertex(o,c),l=this._hydrateFragmentInput(u),h=this.fragment(l),d=new Set;for(const t in h){const e=h[t];(0,P.rz)(d,e)}const p=this._getVertexInputBuiltins(),f=k.createVertex({...s,...a},u,p,n,this.transformFeedbackBindings,d);(new S).write(f);const y=this._getFragmentInputBuiltins(h);y.set("glPointCoord","gl_PointCoord");const x=k.createFragment(l,h,y,n,f,this.transformFeedbackBindings);(new S).write(x);const m=this._createShaderBuilder(f,x),g=m.generate("vertex",!1),_=m.generate("fragment",!1);return this.logShader&&(console.log(g),console.log(_)),{vertex:g,fragment:_,uniformBindings:n}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const r of this._options)e[r.propertyKey]?this[r.propertyKey]=this._hydrateUniformGroup(t,r):this[r.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const r=new(0,e.typeCtor);for(const i of r._uniforms??[]){const n=z(i.typeCtor),s=`u_${e.propertyKey}_${i.propertyKey}`,o=n.type,a=[e.propertyKey,i.propertyKey].join(".");if("type"in i.typeCtor&&"array"===i.typeCtor.type){const e=n;t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:n})}else t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:n});r[i.propertyKey]=n}return r}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,r=e.locations.reduce(((e,r)=>!1===t[r.propertyKey]?e:{...e,[r.propertyKey]:z(r.typeCtor)}),{});for(const{propertyKey:t,typeCtor:i}of e.builtins){const e=z(i);r[t]=e}return r}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce(((t,e)=>({...t,[e.propertyKey]:z(e.typeCtor)})),{})}_injectPackPrecisionFactor(t,e){const r={};for(const i in t){const n=t[i],s=e.attributes.find((t=>t.name===i));if(s?.packPrecisionFactor){if("float"!==n.type&&"vec2"!==n.type&&"vec3"!==n.type&&"vec4"!==n.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${n.type}`);r[i]=n.divide(new b.nt(s.packPrecisionFactor))}else r[i]=n}return r}_hydrateFragmentInput(t){const e={};for(const r in t)e[r]=t[r];for(const{propertyKey:t,typeCtor:r}of R.builtins){const i=z(r);e[t]=i}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:r,propertyKey:i}of t.builtins)e.set(i,r);return e}_getFragmentInputBuiltins(t){const e=t.constructor,r=new Map;for(const t of e.builtins??[])r.set(t.propertyKey,t.builtin);return r}_createShaderBuilder(t,e){const r=new d;return this._insertDebugInfo(r),t.insertVertexShader(r),e.insertFragmentShader(r),r}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}}},82484:(t,e,r)=>{function i(t,e){const r=[];for(r.push(e);r.length;){const e=r.pop();if("object"==typeof e&&!t.has(e.uid)){t.add(e.uid);for(const t of e.children)r.push(t)}}}r.d(e,{XL:()=>u,aw:()=>h,rR:()=>l,rz:()=>i,vA:()=>s,vL:()=>o,zg:()=>c});class n{constructor(){this.uid=n.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=t.split(" ").map(((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t)).join(""),this._debugName=t,this.isImplicit&&this.children[0]instanceof n&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}}function s(t){return"object"==typeof t?t.clone():t}n.NodeCount=0;class o extends n{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends n{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new a(s(this.child));return this.cloneInto(t),t}}class c extends n{constructor(t,e,r){super(),this.property=t,this.target=e,this.returnType=r,this.shaderType="property-access-node"}get children(){const t=[this.target];return"string"!=typeof this.property&&t.push(this.property),t}clone(){const t=new c(this.property,s(this.target),this.returnType);return this.cloneInto(t),t}}class u extends n{constructor(t,e,r){super(),this.condition=t,this.ifTrue=e,this.ifFalse=r,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=s(this.ifTrue),e=this.ifFalse?s(this.ifFalse):null,r=new u(this.condition,t,e);return this.cloneInto(r),r}}class l extends n{constructor(t,e,r,i){super(),this.captureList=t,this.returnType=e,this.generator=i,this.shaderType="block-node",r&&(this.subgraph=new a(r))}get children(){return Object.keys(this.captureList).map((t=>this.captureList[t])).concat(this.subgraph??[])}clone(){const t={};for(const e in this.captureList)t[e]=s(this.captureList[e]);const e=new l(t,this.returnType,this.subgraph?s(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}}class h extends n{constructor(t,e,r,i,n,s=!1){super(),this.token=t,this._children=e,this.isInfix=r,this.isPropertyAccess=i,this.returnType=n,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new h(this.token,this._children.map(s),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}}},15871:(t,e,r)=>{r.d(e,{$5:()=>ft,$I:()=>Y,AU:()=>Lt,Ai:()=>V,Bw:()=>zt,F8:()=>Dt,Io:()=>Mt,LC:()=>dt,MM:()=>yt,My:()=>w,Om:()=>Tt,PM:()=>Bt,RI:()=>kt,S8:()=>Ft,Sj:()=>lt,T9:()=>Nt,TF:()=>Vt,Tk:()=>nt,U:()=>U,US:()=>Rt,Uo:()=>gt,Wh:()=>Z,Xe:()=>pt,ZY:()=>M,Zb:()=>k,Zc:()=>H,aX:()=>xt,eB:()=>T,eR:()=>X,fV:()=>W,gn:()=>Pt,j1:()=>st,jc:()=>It,jh:()=>At,jk:()=>Et,ln:()=>K,mk:()=>wt,nf:()=>ht,nt:()=>P,or:()=>mt,qE:()=>St,tn:()=>_t,w0:()=>q,x:()=>A,z7:()=>S,ze:()=>rt,zi:()=>Ct});var i,n,s,o,a,c,u,l,h,d,p,f,y,x,m=r(82392),g=r(82484);function _(t){return new Proxy(t,{get(e,r){if("constructor"===r)return new Proxy(e.constructor,{construct:(t,e,r)=>_(new t(...e))});if(r in e)return e[r];if("string"==typeof r){const e=function(t){const e=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const r of e)if(r.includes(t))return r.map((t=>G[t]));throw new Error("Unable to find type family")}(t.type);return j(t,r,e[r.length-1])}}})}function v(t){return new Proxy(t,{construct:(t,e,r)=>_(new t(...e))})}class b extends Error{}let w=i=class extends g.vL{constructor(t,e){super(),this.elementType=t,this.size=e,this.children=[],this.type="array"}clone(){const t=new i(this.elementType,this.size);return super.cloneInto(t),t}get(t){if("number"==typeof t){const e=new V(t);return e.isImplicit=!0,j(this,e,this.elementType.constructor)}return j(this,t,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(t,e,r){return function(t,e,r=0,i=t.size){const n=new V(r).setMutable().setDebugName("FindIndexIterator"),s=e(t.get(n)).setDebugName("FindIndexPredicate"),o=it({iter:n},V,s,(({out:t,iter:e,subgraph:r})=>`\n${t} = -1;\n\nfor (; ${e} < ${i}; ${e}++) {\n\n${r.body}\n\n  if (${r.varName}) {\n    ${t} = ${e};\n    break;\n  }\n\n}\n`)).setDebugName("FindIndexBlock");return o}(this,t,e,r)}glslFindIndex(t,e,r){return function(t,e,r=0,i=t.size){const n=it({array:t},V,null,(({out:t,array:n})=>`\n${t} = -1;\nfor (int i = ${r}; i < ${i}; i++) {\n  bool condition;\n  ${e({array:n,i:"i",out:"condition"})}\n  if (condition) {\n    ${t} = i;\n    break;\n  }\n}\n`)).setDebugName("GlslFindIndexBlock");return n}(this,t,e,r)}static ofType(t,e){const r={construct:(r,n)=>new i(new t,e)};return new Proxy(i,r)}};w.type="array",w=i=(0,m._)([function(t){return new Proxy(t,{construct:(t,e,r)=>function(t){return new Proxy(t,{get(e,r){if(r in e)return e[r];if("string"==typeof r){const e=parseInt(r,10);if(!isNaN(e))return j(t,`[${e}]`,t.elementType.constructor)}}})}(new t(...e))})}],w);class S extends g.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}clone(){const t=new S;return t.children=this.children.map(g.vA),super.cloneInto(t),t}}S.type="sampler2D";class P extends g.vL{constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new P((0,g.vA)(this.children[0]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?L(t,P):t)}divide(t){return at(this,"number"==typeof t?L(t,P):t)}add(t){return ct(this,"number"==typeof t?L(t,P):t)}subtract(t){return ut(this,"number"==typeof t?L(t,P):t)}}P.type="float";let M=n=class extends g.vL{constructor(t,e){super(),this.type="vec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new n((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return j(this,"[0]",P)}get 1(){return j(this,"[1]",P)}get 2(){throw new b}get 3(){throw new b}multiply(t){return ot(this,"number"==typeof t?L(t,P):t)}divide(t){return at(this,"number"==typeof t?L(t,P):t)}add(t){return ct(this,"number"==typeof t?L(t,P):t)}subtract(t){return ut(this,"number"==typeof t?L(t,P):t)}};M.type="vec2",M=n=(0,m._)([v],M);let T=s=class extends g.vL{constructor(t,e,r){super(),this.type="vec3",this.children=[t,e,r].filter((t=>null!=t))}get 0(){return j(this,"[0]",P)}get 1(){return j(this,"[1]",P)}get 2(){return j(this,"[2]",P)}get 3(){throw new b}clone(){const t=new s((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]));return super.cloneInto(t),t}multiply(t){return ot(this,"number"==typeof t?L(t,P):t)}divide(t){return at(this,"number"==typeof t?L(t,P):t)}add(t){return ct(this,"number"==typeof t?L(t,P):t)}subtract(t){return ut(this,"number"==typeof t?L(t,P):t)}};T.type="vec3",T=s=(0,m._)([v],T);let k=o=class extends g.vL{constructor(t,e,r,i){super(),this.type="vec4",this.children=[t,e,r,i].filter((t=>null!=t))}clone(){const t=new o((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]),(0,g.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return j(this,"[0]",P)}get 1(){return j(this,"[1]",P)}get 2(){return j(this,"[2]",P)}get 3(){return j(this,"[3]",P)}multiply(t){return ot(this,"number"==typeof t?L(t,P):t)}divide(t){return at(this,"number"==typeof t?L(t,P):t)}add(t){return ct(this,"number"==typeof t?L(t,P):t)}subtract(t){return ut(this,"number"==typeof t?L(t,P):t)}};k.type="vec4",k=o=(0,m._)([v],k);let I=a=class extends g.vL{constructor(t){super(),this.type="uint",this.children=[t]}clone(){const t=new a((0,g.vA)(this.children[0]));return super.cloneInto(t),t}};I.type="uint",I=a=(0,m._)([v],I);let z=c=class extends g.vL{constructor(t,e){super(),this.type="uvec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new c((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]));return super.cloneInto(t),t}};z.type="uvec2",z=c=(0,m._)([v],z);let N=u=class extends g.vL{constructor(t,e,r){super(),this.type="uvec3",this.children=[t,e,r].filter((t=>null!=t))}clone(){const t=new u((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]));return super.cloneInto(t),t}};N.type="uvec3",N=u=(0,m._)([v],N);let E=l=class extends g.vL{constructor(t,e,r,i){super(),this.type="uvec4",this.children=[t,e,r,i].filter((t=>null!=t))}clone(){const t=new l((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]),(0,g.vA)(this.children[3]));return super.cloneInto(t),t}};E.type="uvec4",E=l=(0,m._)([v],E);class A extends g.vL{constructor(t){super(),this.type="bool",this.children=[t]}and(t){return gt(this,t)}or(t){return mt(this,t)}clone(){const t=new A((0,g.vA)(this.children[0]));return super.cloneInto(t),t}}A.type="bool";let C=h=class extends g.vL{constructor(t,e){super(),this.type="bvec2",this.children=[t,e].filter((t=>null!=t))}all(){return vt(this)}any(){return bt(this)}clone(){const t=new h((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]));return super.cloneInto(t),t}};C.type="bvec2",C=h=(0,m._)([v],C);let F=d=class extends g.vL{constructor(t,e,r){super(),this.type="bvec3",this.children=[t,e,r].filter((t=>null!=t))}all(){return vt(this)}any(){return bt(this)}clone(){const t=new d((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]));return super.cloneInto(t),t}};function L(t,e){return"number"==typeof t?new e(t):t}F.type="bvec3",F=d=(0,m._)([v],F);let D=p=class extends g.vL{constructor(t,e,r,i){super(),this.type="bvec4",this.children=[t,e,r,i].filter((t=>null!=t))}all(){return vt(this)}any(){return bt(this)}clone(){const t=new p((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]),(0,g.vA)(this.children[3]));return super.cloneInto(t),t}};D.type="bvec4",D=p=(0,m._)([v],D);class V extends g.vL{constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return ot(this,L(t,V))}add(t){return ct(this,L(t,V))}subtract(t){return ut(this,L(t,V))}divide(t){return at(this,L(t,V))}clone(){const t=new V((0,g.vA)(this.children[0]));return super.cloneInto(t),t}}V.type="int";let B=f=class extends g.vL{constructor(t,e){super(),this.type="ivec2",this.children=[t,e].filter((t=>null!=t))}clone(){const t=new f((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]));return super.cloneInto(t),t}};B.type="ivec2",B=f=(0,m._)([v],B);let R=y=class extends g.vL{constructor(t,e,r){super(),this.type="ivec3",this.children=[t,e,r].filter((t=>null!=t))}clone(){const t=new y((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]));return super.cloneInto(t),t}};R.type="ivec3",R=y=(0,m._)([v],R);let O=x=class extends g.vL{constructor(t,e,r,i){super(),this.type="ivec4",this.children=[t,e,r,i].filter((t=>null!=t))}clone(){const t=new x((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]),(0,g.vA)(this.children[3]));return super.cloneInto(t),t}};O.type="ivec4",O=x=(0,m._)([v],O);class $ extends g.vL{constructor(t,e,r,i){super(),this.type="mat2",this.children=[t,e,r,i]}clone(){const t=new $((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]),(0,g.vA)(this.children[3]));return super.cloneInto(t),t}}$.type="mat2";class U extends g.vL{static identity(){return new U(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=Dt(t),r=Pt(t);return new U(r,e,0,rt(e),r,0,0,0,1)}constructor(t,e,r,i,n,s,o,a,c){super(),this.type="mat3",this.children=[t,e,r,i,n,s,o,a,c]}add(t){return ct(this,t)}multiply(t){return ot(this,t)}clone(){const t=new U((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]),(0,g.vA)(this.children[3]),(0,g.vA)(this.children[4]),(0,g.vA)(this.children[5]),(0,g.vA)(this.children[6]),(0,g.vA)(this.children[7]),(0,g.vA)(this.children[8]));return super.cloneInto(t),t}}U.type="mat3";class Y extends g.vL{static identity(){return new Y(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,r,i,n,s,o,a,c,u,l,h,d,p,f,y){super(),this.type="mat4",this.children=[t,e,r,i,n,s,o,a,c,u,l,h,d,p,f,y]}static fromColumns(t,e,r,i){return new Y(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,r.x,r.y,r.z,r.w,i.x,i.y,i.z,i.w)}multiply(t){return ot(this,t)}clone(){const t=new Y((0,g.vA)(this.children[0]),(0,g.vA)(this.children[1]),(0,g.vA)(this.children[2]),(0,g.vA)(this.children[3]),(0,g.vA)(this.children[4]),(0,g.vA)(this.children[5]),(0,g.vA)(this.children[6]),(0,g.vA)(this.children[7]),(0,g.vA)(this.children[8]),(0,g.vA)(this.children[9]),(0,g.vA)(this.children[10]),(0,g.vA)(this.children[11]),(0,g.vA)(this.children[12]),(0,g.vA)(this.children[13]),(0,g.vA)(this.children[14]),(0,g.vA)(this.children[15]));return super.cloneInto(t),t}}Y.type="mat4";const G={float:P,vec2:M,vec3:T,vec4:k,int:V,ivec2:B,ivec3:R,ivec4:O,uint:I,uvec2:z,uvec3:N,uvec4:E,bool:A,bvec2:C,bvec3:F,bvec4:D},Z=(...t)=>new V(...t),W=(...t)=>new P(...t),H=(...t)=>new M(...t),X=(...t)=>new T(...t),K=(...t)=>new k(...t),q=(...t)=>new U(...t);function j(t,e,r){const i=new r(new g.zg(e,t,r));return i.isImplicit=!0,i}function Q(t,e,r,i=null){if(i){const n=new i,s=new i(new g.aw(t,[e,r],!0,!1,n));return s.isImplicit=!0,s}if("float"===e.type||"int"===e.type){const i=new r.constructor(new g.aw(t,[e,r],!0,!1,r.constructor));return i.isImplicit=!0,i}if(("mat2"===e.type||"mat3"===e.type||"mat4"===e.type)&&"float"!==r.type){const i=new r.constructor(new g.aw(t,[e,r],!0,!1,r.constructor));return i.isImplicit=!0,i}const n=new e.constructor(new g.aw(t,[e,r],!0,!1,e.constructor));return n.isImplicit=!0,n}function J(t,e,r=e.constructor){const i=new r(new g.aw(t,[e],!1,!1,r));return i.isImplicit=!0,i}function tt(t,e,r,i=e.constructor){const n=new i(new g.aw(t,[e,r],!1,!1,i));return n.isImplicit=!0,n}function et(t,e,r,i,n=e.constructor){const s=new n(new g.aw(t,[e,r,i],!1,!1,n));return s.isImplicit=!0,s}function rt(t){return ot(t,W(-1))}function it(t,e,r,i){return new e(new g.rR(t,e,r,i))}function nt(t,e,r){const i="function"==typeof e?e():e,n="function"==typeof r?r():r,s=new i.constructor(new g.XL(t,i,n));return s.isImplicit=!0,s}function st(...t){const e=t.map((([t,e])=>"function"==typeof e?[t,e()]:[t,e])),r=e[0][1].constructor,i=e.findIndex((t=>!0===t[0]));if(-1===i)throw new Error("A cond must have a fallthrough case with `true`/; ");const n=e.slice(0,i),s=e[i][1],o=new r(n.reduceRight(((t,e)=>nt(e[0],e[1],t)),s));return o.isImplicit=!0,o}function ot(t,e){return Q("*",t,e)}function at(t,e){return Q("/",t,e)}function ct(t,e){return Q("+",t,e)}function ut(t,e){return Q("-",t,e)}function lt(t,e){return Q(">>",t,e)}function ht(t,e){return Q("&",t,e)}function dt(t,e){return Q("==",t,e,A)}function pt(t,e){return Q("<",t,e,A)}function ft(t,e){return Q("<=",t,e,A)}function yt(t,e){return Q(">",t,e,A)}function xt(t,e){return Q(">=",t,e,A)}function mt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("||",t,e,A)}(t,e)),t[0])}function gt(...t){return t.length<=1?t[0]:t.slice(1).reduce(((t,e)=>function(t,e){return Q("&&",t,e,A)}(t,e)),t[0])}function _t(t){return J("abs",t)}function vt(t){return J("all",t,A)}function bt(t){return J("any",t,A)}function wt(t){return J("ceil",t)}function St(t,e,r){return et("clamp",t,e,r,t.constructor)}function Pt(t){return J("cos",t)}function Mt(t,e){return tt("distance",t,e,P)}function Tt(t,e){return tt("dot",t,e,P)}function kt(t){return J("floor",t)}function It(t){return J("fract",t)}function zt(t){return J("length",t,P)}function Nt(t,e){return tt("max",t,e)}function Et(t,e){return tt("min",t,e)}function At(t,e,r){return et("mix",t,e,r)}function Ct(t,e){return tt("mod",t,e)}function Ft(t){return J("normalize",t)}function Lt(t){return"bool"===t.type?J("!",t):J("not",t)}function Dt(t){return J("sin",t)}function Vt(t,e,r){return et("smoothstep",t,e,r)}function Bt(t,e){return tt("step",t,e,e.constructor)}function Rt(t,e){return tt("texture2D",t,e,k)}},49093:(t,e,r)=>{r.d(e,{c:()=>i});const i={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4}}},95373:(t,e,r)=>{r.d(e,{Y:()=>Ae});var i=r(6273),n=r(20472),s=(r(91814),r(15303)),o=r(65977),a=r(6538);function c(t,e,r,i,n,s,o){C=0;const a=(i-r)*s,c=n&&n.length,l=c?(n[0]-r)*s:a;let d,p,f,y,x,g=u(e,r,0,0,l,s,!0);if(g&&g.next!==g.prev){if(c&&(g=m(e,r,i,n,g,s)),a>80*s){d=f=e[0+r*s],p=y=e[1+r*s];for(let t=s;t<l;t+=s){const i=e[t+r*s],n=e[t+1+r*s];d=Math.min(d,i),p=Math.min(p,n),f=Math.max(f,i),y=Math.max(y,n)}x=Math.max(f-d,y-p),x=0!==x?1/x:0}h(g,t,s,d,p,x,o,0)}}function u(t,e,r,i,n,s,o){let a;if(o===function(t,e,r,i,n,s){let o=0;for(let r=i,a=n-s;r<n;r+=s)o+=(t[a+e*s]-t[r+e*s])*(t[r+1+e*s]+t[a+1+e*s]),a=r;return o}(t,e,0,i,n,s)>0)for(let r=i;r<n;r+=s)a=f(r+e*s,t[r+e*s],t[r+1+e*s],a);else for(let r=n-s;r>=i;r-=s)a=f(r+e*s,t[r+e*s],t[r+1+e*s],a);return a&&M(a,a.next)&&(y(a),a=a.next),a}function l(t,e=t){if(!t)return t;let r,i=t;do{if(r=!1,i.steiner||!M(i,i.next)&&0!==v(i.prev,i,i.next))i=i.next;else{if(y(i),i=e=i.prev,i===i.next)break;r=!0}}while(r||i!==e);return e}function h(t,e,r,i,n,s,o,a){if(!t)return;!a&&s&&(t=_(t,i,n,s));let c=t;for(;t.prev!==t.next;){const u=t.prev,f=t.next;if(s?p(t,i,n,s):d(t))e.push(u.index/r+o),e.push(t.index/r+o),e.push(f.index/r+o),y(t),t=f.next,c=f.next;else if((t=f)===c){a?1===a?h(t=k(t,e,r,o),e,r,i,n,s,o,2):2===a&&I(t,e,r,i,n,s,o):h(l(t),e,r,i,n,s,o,1);break}}}function d(t){const e=t.prev,r=t,i=t.next;if(v(e,r,i)>=0)return!1;let n=t.next.next;const s=n;let o=0;for(;n!==t.prev&&(0===o||n!==s);){if(o++,w(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&v(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function p(t,e,r,i){const n=t.prev,s=t,o=t.next;if(v(n,s,o)>=0)return!1;const a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,c=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,u=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,l=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=P(a,c,e,r,i),d=P(u,l,e,r,i);let p=t.prevZ,f=t.nextZ;for(;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&v(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&w(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&v(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function f(t,e,r,i){const n=E.create(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function y(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function x(t){let e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function m(t,e,r,i,n,s){const o=new Array;for(let n=0,a=i.length;n<a;n++){const c=u(t,e,0,i[n]*s,n<a-1?i[n+1]*s:r*s,s,!1);c===c.next&&(c.steiner=!0),o.push(x(c))}o.sort(T);for(const t of o)n=g(t,n);return n}function g(t,e){const r=function(t,e){let r=e;const i=t.x,n=t.y;let s,o=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){const t=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(t<=i&&t>o){if(o=t,t===i){if(n===r.y)return r;if(n===r.next.y)return r.next}s=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!s)return null;if(i===o)return s.prev;const a=s,c=s.x,u=s.y;let l,h=1/0;for(r=s.next;r!==a;)i>=r.x&&r.x>=c&&i!==r.x&&w(n<u?i:o,n,c,u,n<u?o:i,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(i-r.x),(l<h||l===h&&r.x>s.x)&&S(r,t)&&(s=r,h=l)),r=r.next;return s}(t,e);if(!r)return e;const i=N(r,t);return l(i,i.next),l(r,r.next)}function _(t,e,r,i){let n;for(;n!==t;n=n.next){if(n=n||t,null===n.z&&(n.z=P(n.x,n.y,e,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,_(t,e,r,i);n.prevZ=n.prev,n.nextZ=n.next}return t.prevZ.nextZ=null,t.prevZ=null,function(t){let e,r=1;for(;;){let i,n=t;t=null,e=null;let s=0;for(;n;){s++,i=n;let o=0;for(;o<r&&i;o++)i=i.nextZ;let a=r;for(;o>0||a>0&&i;){let r;0===o?(r=i,i=i.nextZ,a--):0!==a&&i?n.z<=i.z?(r=n,n=n.nextZ,o--):(r=i,i=i.nextZ,a--):(r=n,n=n.nextZ,o--),e?e.nextZ=r:t=r,r.prevZ=e,e=r}n=i}if(e.nextZ=null,r*=2,s<2)return t}}(t)}function v(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function b(t,e,r,i){return!!(M(t,e)&&M(r,i)||M(t,i)&&M(r,e))||v(t,e,r)>0!=v(t,e,i)>0&&v(r,i,t)>0!=v(r,i,e)>0}function w(t,e,r,i,n,s,o,a){return(n-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(r-o)*(e-a)>=0&&(r-o)*(s-a)-(n-o)*(i-a)>=0}function S(t,e){return v(t.prev,t,t.next)<0?v(t,e,t.next)>=0&&v(t,t.prev,e)>=0:v(t,e,t.prev)<0||v(t,t.next,e)<0}function P(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function M(t,e){return t.x===e.x&&t.y===e.y}function T(t,e){return t.x-e.x}function k(t,e,r,i){let n=t;do{const s=n.prev,o=n.next.next;!M(s,o)&&b(s,n,n.next,o)&&S(s,o)&&S(o,s)&&(e.push(s.index/r+i),e.push(n.index/r+i),e.push(o.index/r+i),y(n),y(n.next),n=t=o),n=n.next}while(n!==t);return n}function I(t,e,r,i,n,s,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.index!==t.index&&z(a,t)){let c=N(a,t);return a=l(a,a.next),c=l(c,c.next),h(a,e,r,i,n,s,o,0),void h(c,e,r,i,n,s,o,0)}t=t.next}a=a.next}while(a!==t)}function z(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let r=t;do{if(r.index!==t.index&&r.next.index!==t.index&&r.index!==e.index&&r.next.index!==e.index&&b(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&S(t,e)&&S(e,t)&&function(t,e){let r=t,i=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==t);return i}(t,e)}function N(t,e){const r=E.create(t.index,t.x,t.y),i=E.create(e.index,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}class E{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,r){const i=C<A.length?A[C++]:new E;return i.index=t,i.x=e,i.y=r,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}const A=[];let C=0;for(let t=0;t<8096;t++)A.push(new E);const F=new s.O3(0,0,0,1,0),L=new s.O3(0,0,0,1,0);function D(t,e,r){let i=0;for(let n=1;n<r;n++){const r=t[2*(e+n-1)],s=t[2*(e+n-1)+1];i+=(t[2*(e+n)]-r)*(t[2*(e+n)+1]+s)}return i}function V(t,e,r,i,n){let s=0;for(let o=r;o<i;o+=3){const r=2*(t[o]-n),i=2*(t[o+1]-n),a=2*(t[o+2]-n);s+=Math.abs((e[r]-e[a])*(e[i+1]-e[r+1])-(e[r]-e[i])*(e[a+1]-e[r+1]))}return s}F.setExtent(a.CQ),L.setExtent(a.CQ);var B=r(52266),R=r(92524);let O=null;function $(){return O}var U=r(93911),Y=r(43135),G=r(68716);function Z(t){switch(t){case G.pe.BYTE:case G.pe.UNSIGNED_BYTE:return 1;case G.pe.SHORT:case G.pe.UNSIGNED_SHORT:return 2;case G.pe.FLOAT:case G.pe.INT:case G.pe.UNSIGNED_INT:return 4}}class W{static fromVertexSpec({attributes:t},e){let r,i,n;const s=[];for(const o in t){const a=t[o];!1!==e?.[o]&&("position"===a.pack?r={...a,name:o,offset:0}:"id"===a.pack?i={...a,name:o,offset:4}:"bitset"===o?n={...a,name:o,offset:7}:s.push({...a,name:o}))}const o=function(t){const e=[],r=[],i=[];for(const n of t){const t=Z(n.type)*n.count;switch(t%2||t%4||4){case 4:e.push(n);continue;case 2:r.push(n);continue;case 1:i.push(n);continue;default:throw new Error("Found unexpected dataType byte count")}}return e.push(...r),e.push(...i),e}(s),a=[];let c=8,u=1;for(const t of o)a.push({...t,offset:c}),c+=Z(t.type)*t.count,t.packAlternating&&(u=Math.max(t.packAlternating.count,u));const l=Uint32Array.BYTES_PER_ELEMENT,h=c%l;return new W(r,i,n,a,c+(h?l-h:0),u)}constructor(t,e,r,i,n,s){this.position=t,this.id=e,this.bitset=r,this.standardAttributes=i,this.stride=n,this.packVertexCount=s,i.push(r),this._attributes=[t,e,r,...i]}get attributeLayout(){if(!this._attributeLayout){const t=(0,Y.h)(this._attributes),e=this._attributes.map((t=>({name:t.name,count:t.count,offset:t.offset,type:t.type,packPrecisionFactor:t.packPrecisionFactor,normalized:t.normalized??!1})));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}}var H=r(30188);class X{static fromVertexSpec(t,e){const r=W.fromVertexSpec(t,e);return new X(r)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,r,i,n,s){for(let t=0;t<this._spec.packVertexCount;t++){const o=t*this._spec.stride;this._packPosition(r,i,o),this._packId(e,o);const a=this._spec.bitset;if(s){if(a.packTessellation){const t=a.packTessellation(s,n);this._pack(t,a,o)}for(const t of this._spec.standardAttributes)if(null!=t.packTessellation){const e=t.packTessellation(s,n);this._pack(e,t,o)}else if(t.packAlternating?.packTessellation){const e=t.packAlternating.packTessellation(s,n);for(let r=0;r<this._spec.packVertexCount;r++){const i=e[r];this._pack(i,t,r*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,e){for(const r of this._spec.standardAttributes)if(r.pack&&"string"!=typeof r.pack){const i=r.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++)this._pack(i,r,t*this._spec.stride)}else if(r.packAlternating?.pack){const i=r.packAlternating.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++){const e=i[t];this._pack(e,r,t*this._spec.stride)}}}_packPosition(t,e,r){const{offset:i}=this._spec.position,n=this._spec.position.packPrecisionFactor??1,s=(0,U.M9)(t*n,e*n);this._dataView.setUint32(r+i,s,!0)}_packId(t,e){const r=t*(this._spec.id.packPrecisionFactor??1),i=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,r|i,!0)}_pack(t,e,r){(0,H.F)(this._dataView,t,e,r)}}class K{constructor(t,e,r,i){this._instanceId=t,this._evaluator=e,this._viewParams=r,this._optionalAttributes=i,this._evaluator.evaluator=t=>this.vertexSpec.createComputedParams(t)}get _vertexPack(){if(!this._cachedVertexPack){const t=X.fromVertexSpec(this.vertexSpec,this._optionalAttributes);this._evaluator.hasDynamicProperties||t.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=t}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(t){this._references=t}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){(function(t){if(!t)return!1;for(const e of t)switch(e.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1})(this._evaluator.inputMeshParams.params.effects?.effectInfos)&&await async function(){O=await Promise.all([r.e(7313),r.e(7963)]).then(r.bind(r,30344))}()}enqueueRequest(t,e,r){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(t,e,r)}write(t,e,r,i,n){this.ensurePacked(e,r,i);const s=this.evaluatedMeshParams.effects;if(!s||0===s.length)return void this._write(t,r,void 0,n);const o=r.readGeometryForDisplay()?.clone();if(!o)return;const a=B.z.fromOptimizedCIM(o,r.geometryType),c=$();a.invertY();const u=t.id||"",l=R.V.executeEffects(s,a,u,c);let h;for(;h=l.next();)h.invertY(),this._write(t,r,h,n)}ensurePacked(t,e,r){if(!this._evaluator.hasDynamicProperties)return;const i=this._evaluator.evaluateMeshParams(t,e,r);this._vertexPack.pack(i,this._viewParams)}_writeVertex(t,e,r,i,n){const s=this.evaluatedMeshParams;this._vertexPack.writeVertex(t,e,r,i,s,n)}}const q=(0,i.A)("featurelayer-fast-triangulation-enabled");class j extends K{async loadDependencies(){await Promise.all([super.loadDependencies(),(0,n.F)()])}_write(t,e,r){const i=r?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);n&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,n),t.recordEnd())}_clip(t){return t?function(t,e){if(null==t)return null;if(!function(t,e,r){let i=0;for(let e=0;e<t.lengths.length;e++){const n=t.lengths[e];for(let e=0;e<n;e++){const n=t.coords[2*(e+i)],s=t.coords[2*(e+i)+1];if(n<-128||n>r||s<-128||s>r)return!0}i+=n}return!1}(t,0,a.CQ+128))return t;F.setPixelMargin(e),F.reset(s.dC.Polygon);let r=0;for(let e=0;e<t.lengths.length;e++){const i=t.lengths[e];let n=t.coords[2*(0+r)],s=t.coords[2*(0+r)+1];F.moveTo(n,s);for(let e=1;e<i;e++)n=t.coords[2*(e+r)],s=t.coords[2*(e+r)+1],F.lineTo(n,s);F.close(),r+=i}const i=F.result(!1);if(!i)return null;const n=[],c=[];for(const t of i){let e=0;for(const r of t)c.push(r.x),c.push(r.y),e++;n.push(e)}return new o.A(n,c)}(t,this.hasEffects?256:8):null}_writeGeometry(t,e,r){const i=r.maxLength>100,s=[],o=this.createTesselationParams(e);if(!i&&q&&function(t,e){const{coords:r,lengths:i,hasIndeterminateRingOrder:n}=e,s=t;if(n)return!1;let o=0;for(let t=0;t<i.length;){let e=t,n=i[t],a=D(r,o,n);const u=[];for(;++e<i.length;){const t=i[e],s=D(r,o+n,t);if(!(s>0))break;a+=s,u.push(o+n),n+=t}const l=s.length;c(s,r,o,o+n,u,2,0);const h=V(s,r,l,s.length,0),d=Math.abs(a);if(Math.abs((h-d)/Math.max(1e-7,d))>1e-5)return s.length=0,!1;t=e,o+=n}return!0}(s,r))return void(s.length&&this._writeVertices(t,e,r.coords,o,s));const a=function(t){const{coords:e,lengths:r}=t,{buffer:i}=(0,n.l)(e,r);return i}(r);this._writeVertices(t,e,a,o)}_writeVertices(t,e,r,i,n){const s=e.getDisplayId(),o=t.vertexCount(),a=this.hasEffects;let c=0;if(n)for(const e of n){const n=r[2*e],o=r[2*e+1];a&&t.recordBounds(n,o,0,0),this._writeVertex(t,s,n,o,i),c++}else for(let e=0;e<r.length;e+=2){const n=Math.round(r[e]),o=Math.round(r[e+1]);a&&t.recordBounds(n,o,0,0),this._writeVertex(t,s,n,o,i),c++}t.indexEnsureSize(c);for(let e=0;e<c;e++)t.indexWrite(e+o)}}const Q={createComputedParams:t=>t,attributes:{id:{type:G.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:G.pe.UNSIGNED_BYTE,count:1},pos:{type:G.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:G.pe.FLOAT,count:1,packTessellation:({inverseArea:t})=>t}}};var J=r(23572),tt=r(40396),et=r(93814),rt=r(62991),it=r(80861),nt=r(85953);function st(t,e){return[!!t?.minScale&&e.scaleToZoom(t.minScale)||0,!!t?.maxScale&&e.scaleToZoom(t.maxScale)||100]}function ot(t){return 1<<t}function at(t){let e=0;for(const[r,i]of t)i&&(e|=1<<r);return e}function ct(t){let e;if(!t)return[0,0,0,0];if("string"==typeof t){const r=et.A.fromString(t);if(!r)return it.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new rt.A("mapview:mesh-processing","Unable to parse string into color",{color:t})),[0,0,0,0];e=r.toArray()}else e=t;const[r,i,n,s]=e;return[r*(s/255),i*(s/255),n*(s/255),s]}function ut(t,e){return Math.round(Math.min(Math.sqrt(t*e),255))}function lt(t,e){return Math.round(t*e)/e}function ht(t,e){return Math.ceil(t*e)/e}const dt={createComputedParams:t=>t,attributes:{id:{type:G.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:G.pe.UNSIGNED_BYTE,count:1},pos:{type:G.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},zoomRange:{type:G.pe.SHORT,count:2,packPrecisionFactor:a.fq,pack:({scaleInfo:t},{tileInfo:e})=>st(t,e)},color:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>ct(t)}}};class pt extends j{constructor(){super(...arguments),this.vertexSpec=dt}createTesselationParams(t){return null}}const ft={createComputedParams:t=>t,attributes:{...dt.attributes,tlbr:{count:4,type:G.pe.UNSIGNED_SHORT,pack:({sprite:t})=>{const{rect:e,width:r,height:i}=t,n=e.x+a.hM,s=e.y+a.hM;return[n,s,n+r,s+i]}},inverseRasterizationScale:{count:1,type:G.pe.BYTE,packPrecisionFactor:16,pack:({sprite:t})=>1/t.rasterizationScale}}};class yt extends pt{constructor(){super(...arguments),this.vertexSpec=ft}_write(t,e,r){const i=r?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);if(!n)return;const s=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(t,e,n),t.recordEnd()}}var xt=r(77330);function mt(t){const{sprite:e,aspectRatio:r,scaleProportionally:i}=t,n=(0,J.Lz)(t.height),s=n>0?n:e.height;let o=n*r;return o<=0?o=e.width:i&&(o*=e.width/e.height),{width:o,height:s}}function gt(t){const{applyRandomOffset:e,sampleAlphaOnly:r}=t,{width:i,height:n}=mt(t);return at([[xt.Fz,e],[xt.cn,r],[xt.A,i<a.Tv],[xt.lx,n<a.Tv]])}function _t(t){const{width:e}=mt(t);return Math.round(e<a.Tv?e*a.bg:e)}function vt(t){const{height:e}=mt(t);return Math.round(e<a.Tv?e*a.bg:e)}const bt={createComputedParams:t=>t,attributes:{...ft.attributes,bitset:{count:1,type:G.pe.UNSIGNED_BYTE,pack:gt},width:{count:1,type:G.pe.UNSIGNED_SHORT,pack:_t},height:{count:1,type:G.pe.UNSIGNED_SHORT,pack:vt},offset:{count:2,type:G.pe.SHORT,pack:({offsetX:t,offsetY:e})=>[(0,J.Lz)(t),-(0,J.Lz)(e)]},scale:{count:2,type:G.pe.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:t,scaleY:e})=>[t,e]},angle:{count:1,type:G.pe.UNSIGNED_BYTE,pack:({angle:t})=>(0,tt.wV)(t)}}};var wt=r(73274);class St{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0}}const Pt={createComputedParams:t=>t,attributes:{id:{type:G.pe.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:G.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:G.pe.UNSIGNED_BYTE,count:1},zoomRange:{type:G.pe.SHORT,count:2,packPrecisionFactor:a.fq,pack:({scaleInfo:t},{tileInfo:e})=>st(t,e)},color:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>ct(t)},offset:{type:G.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[lt(t,16),lt(e,16)]},normal:{type:G.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:t,normalY:e})=>[lt(t,16),lt(e,16)]},halfWidth:{type:G.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({width:t})=>ht((0,J.Lz)(.5*t),16)},referenceHalfWidth:{type:G.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:16,pack:({referenceWidth:t})=>ht((0,J.Lz)(.5*t),16)}}};class Mt{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0}}class Tt extends K{constructor(t,e,r,i){super(t,e,r,i),this.vertexSpec=Pt,this._currentWrite=new Mt,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._tessParams=new St,this._initializeTessellator()}writeLineVertices(t,e,r){const i=this._getLines(e);null!=i&&this._writeVertices(t,r,i)}_initializeTessellator(){this._lineTessellator=new wt.i(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(t,e,r){const i=r??B.z.fromFeatureSetReaderCIM(e);i&&this._writeGeometry(t,e,i)}_writeGeometry(t,e,r,i){t.recordStart(this.instanceId,this.attributeLayout,i),this.writeLineVertices(t,r,e),t.recordEnd()}_getLines(t){return function(t,e){L.setPixelMargin(e);const r=L,i=-e,n=a.CQ+e;let o=[],c=!1;if(!t.nextPath())return null;let u=!0;for(;u;){t.seekPathStart();const e=[];if(!t.pathSize)return null;r.reset(s.dC.LineString),t.nextPoint();let a=t.x,l=t.y;if(c)r.moveTo(a,l);else{if(a<i||a>n||l<i||l>n){c=!0;continue}e.push({x:a,y:l})}let h=!1;for(;t.nextPoint();)if(a=t.x,l=t.y,c)r.lineTo(a,l);else{if(a<i||a>n||l<i||l>n){h=!0;break}e.push({x:a,y:l})}if(h)c=!0;else{if(c){const t=r.resultWithStarts();if(t)for(const e of t)o.push(e)}else o.push({line:e,start:0});u=t.nextPath(),c=!1}}return o=o.filter((t=>t.line.length>1)),0===o.length?null:o}(t,this.hasEffects?256:16)}_writeVertices(t,e,r){const{_currentWrite:i,_tessellationOptions:n,evaluatedMeshParams:s}=this,{width:o,capType:c,joinType:u,miterLimit:l,hasSizeVV:h}=s,d=(0,J.Lz)(.5*o);n.halfWidth=d,n.capType=function(t){switch(t){case"butt":case nt.uT.Butt:return nt.xR.BUTT;case"round":case nt.uT.Round:return nt.xR.ROUND;case"square":case nt.uT.Square:return nt.xR.SQUARE}}(c),n.joinType=function(t){switch(t){case"bevel":case nt.wd.Bevel:return nt.JO.BEVEL;case"miter":case nt.wd.Miter:return nt.JO.MITER;case"round":case nt.wd.Round:return nt.JO.ROUND}}(u),n.miterLimit=l;const p=!h;i.out=t,i.id=e.getDisplayId(),i.vertexCount=0,i.indexCount=0,i.vertexFrom=t.vertexCount(),i.vertexBounds=p&&d<a.Gh?0:1;for(const{line:t,start:e}of r)n.initialDistance=e%65535,this._lineTessellator.tessellate(t,n,p)}_writeTesselatedVertex(t,e,r,i,n,s,o,a,c,u,l){const{out:h,id:d,vertexBounds:p}=this._currentWrite;return this.hasEffects&&h.recordBounds(t,e,p,p),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=c,this._tessParams.normalY=u,this._tessParams.directionX=n,this._tessParams.directionY=s,this._tessParams.distance=l,this._writeVertex(h,d,t,e,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,e,r){const{out:i}=this._currentWrite;i.indexEnsureSize(3),i.indexWrite(t),i.indexWrite(e),i.indexWrite(r),this._currentWrite.indexCount+=3}}const kt={createComputedParams:t=>t,attributes:{...Pt.attributes,bitset:{type:G.pe.UNSIGNED_BYTE,count:1,pack:t=>0},color:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>ct(t)}}},It={createComputedParams:t=>t,attributes:{...Pt.attributes,bitset:{type:G.pe.UNSIGNED_BYTE,count:1,pack:t=>at([[xt.Xx,!0]])},color:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>ct(t)}}};class zt extends Tt{constructor(){super(...arguments),this.vertexSpec=It}}class Nt extends pt{constructor(t,e,r,i){super(t,e,r,i),this.vertexSpec=kt,this._lineMeshWriter=this._createOutlineWriter(t,e,r,i)}_createOutlineWriter(t,e,r,i){return new zt(t,e,r,i)}_write(t,e,r){const i=r?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);n&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,B.z.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd())}ensurePacked(t,e,r){super.ensurePacked(t,e,r),this._lineMeshWriter.ensurePacked(t,e,r)}enqueueRequest(t,e,r){super.enqueueRequest(t,e,r),this._lineMeshWriter.enqueueRequest(t,e,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}var Et=r(86049);const At=bt.attributes,Ct=It.attributes,Ft={createComputedParams:t=>t,attributes:{id:At.id,pos:At.pos,zoomRange:At.zoomRange,tlbr:At.tlbr,angle:At.angle,color:At.color,bitset:{type:G.pe.UNSIGNED_BYTE,count:1,pack:t=>gt(t)},aux1:{count:1,type:G.pe.UNSIGNED_SHORT,pack:t=>_t(t)},aux2:{count:1,type:G.pe.UNSIGNED_SHORT,pack:t=>vt(t)},aux3:{count:2,type:G.pe.SHORT,pack:({offsetX:t,offsetY:e})=>[(0,J.Lz)(t),(0,J.Lz)(e)]},aux4:{count:2,type:G.pe.UNSIGNED_BYTE,pack:({scaleX:t,scaleY:e})=>[t*Et.cZ,e*Et.cZ]}}},Lt={createComputedParams:t=>t,attributes:{id:At.id,pos:At.pos,zoomRange:At.zoomRange,tlbr:At.tlbr,angle:At.angle,color:Ct.color,bitset:{type:G.pe.UNSIGNED_BYTE,count:1,pack:t=>at([[xt.Xx,!0]])},aux1:{count:1,type:G.pe.UNSIGNED_SHORT,pack:t=>(0,J.Lz)(.5*t.width)*Et.cZ},aux2:{count:1,type:G.pe.UNSIGNED_SHORT,pack:t=>(0,J.Lz)(.5*t.referenceWidth)*Et.cZ},aux3:{count:2,type:G.pe.SHORT,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[t*Et.cZ,e*Et.cZ]},aux4:{count:2,type:G.pe.UNSIGNED_BYTE,packTessellation:({normalX:t,normalY:e})=>[t*Et.cZ+Et.v9,e*Et.cZ+Et.v9]}}};class Dt extends zt{constructor(){super(...arguments),this.vertexSpec=Lt}}const Vt={createComputedParams:t=>t,attributes:{...ft.attributes,...kt.attributes}},Bt={createComputedParams:t=>t,attributes:{...ft.attributes,...It.attributes}};class Rt extends zt{constructor(){super(...arguments),this.vertexSpec=Bt}}const Ot={createComputedParams:t=>t,attributes:{pos:{type:G.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:G.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:G.pe.UNSIGNED_BYTE,count:1},offset:{type:G.pe.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};var $t=r(80294),Ut=r(94464),Yt=r(68749),Gt=r(99576),Zt=r(31927),Wt=r(87574),Ht=r(61866);function Xt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Kt(t,e){return Math.sqrt(t*t+e*e)}function qt(t){const e=Kt(t[0],t[1]);t[0]/=e,t[1]/=e}function jt(t,e){return Kt(t[0]-e[0],t[1]-e[1])}function Qt(t){return t.length-1}function Jt(t,e,r=1){let[i,n]=function(t,e){return t[e+1]}(t,e);return[i,n]=[Math.round(i),Math.round(n)],Math.sqrt(i*i+n*n)*r}class te{constructor(t,e,r,i,n){this._segments=t,this._index=e,this._distance=r,this._xStart=i,this._yStart=n,this._done=!1}static create(t){return new te(t,0,0,t[0][0],t[0][1])}clone(){return new te(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let r=Math.acos(e);return t>0&&(r=2*Math.PI-r),r}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<Qt(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const r=this.backwardLength;if(t<=r)return this._distance=(r-t)/this.length,this;let i=this.backwardLength;for(;this.prev();){if(i+this.length>t)return this._seekBackwards(t-i);i+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let r=this.remainingLength;for(;this.next();){if(r+this.length>t)return this.seek(t-r,e);r+=this.length}return this._distance=1,e?this:null}}function ee(t,e,r,i=!0){const n=function(t){let e=0;for(let r=0;r<Qt(t);r++)e+=Jt(t,r);return e}(t),s=te.create(t),o=n/2;if(!i)return s.seek(o),void(Math.abs(s.x)<Ht.s&&Math.abs(s.y)<Ht.s&&r(s.clone(),0,o+0*e,n));const a=Math.max((n-e)/2,0),c=Math.floor(a/e),u=o-c*e;s.seek(u);for(let t=-c;t<=c;t++)Math.abs(s.x)<Ht.s&&Math.abs(s.y)<Ht.s&&r(s.clone(),t,o+t*e,n),s.seek(e)}function re(t,e){const r=1e-6;if(e<=0)return;const i=t.length;if(i<3)return;const n=[];let s=0;n.push(0);for(let e=1;e<i;e++)s+=jt(t[e],t[e-1]),n.push(s);e=Math.min(e,.2*s);const o=[];o.push(t[0][0]),o.push(t[0][1]);const a=t[i-1][0],c=t[i-1][1],u=Xt([0,0],t[0],t[1]);qt(u),t[0][0]+=e*u[0],t[0][1]+=e*u[1],Xt(u,t[i-1],t[i-2]),qt(u),t[i-1][0]+=e*u[0],t[i-1][1]+=e*u[1];for(let t=1;t<i;t++)n[t]+=e;n[i-1]+=e;const l=.5*e;for(let s=1;s<i-1;s++){let a=0,c=0,u=0;for(let i=s-1;i>=0&&!(n[i+1]<n[s]-l);i--){const o=l+n[i+1]-n[s],h=n[i+1]-n[i],d=n[s]-n[i]<l?1:o/h;if(Math.abs(d)<r)break;const p=d*d,f=d*o-.5*p*h,y=d*h/e,x=t[i+1],m=t[i][0]-x[0],g=t[i][1]-x[1];a+=y/f*(x[0]*d*o+.5*p*(o*m-h*x[0])-p*d*h*m/3),c+=y/f*(x[1]*d*o+.5*p*(o*g-h*x[1])-p*d*h*g/3),u+=y}for(let o=s+1;o<i&&!(n[o-1]>n[s]+l);o++){const i=l-n[o-1]+n[s],h=n[o]-n[o-1],d=n[o]-n[s]<l?1:i/h;if(Math.abs(d)<r)break;const p=d*d,f=d*i-.5*p*h,y=d*h/e,x=t[o-1],m=t[o][0]-x[0],g=t[o][1]-x[1];a+=y/f*(x[0]*d*i+.5*p*(i*m-h*x[0])-p*d*h*m/3),c+=y/f*(x[1]*d*i+.5*p*(i*g-h*x[1])-p*d*h*g/3),u+=y}o.push(a/u),o.push(c/u)}o.push(a),o.push(c);for(let e=0,r=0;e<i;e++)t[e][0]=o[r++],t[e][1]=o[r++]}var ie=r(4506),ne=r(32199);class se{static getPlacement(t,e,r,i,n,s){const o=(0,ne.c)(r);return o?(-1===e&&t.invertY(),o.execute(t,r,i,n,s)):null}}var oe=r(67601),ae=r(77234);class ce{constructor(t){const{offsetX:e,offsetY:r,postAngle:i,fontSize:n,scaleFactor:s,transforms:o}=t;if(this.offsetX=e,this.offsetY=r,this.postAngle=i,this.fontSize=Math.min(n,96),this.transforms=o,o&&o.infos.length>1){const t=(0,ae.zb)(n,i,!1,e,r,o);this.fontSize=Math.min(t.size,96),this.postAngle=t.rotation,this.offsetX=t.offsetX,this.offsetY=t.offsetY}s&&(this.fontSize*=s,this.offsetX*=s,this.offsetY*=s)}}const ue=[4,4],le=[16,4],he={topLeft:le,topRight:le,bottomLeft:le,bottomRight:le},de=[4,2],pe=[4,6],fe={topLeft:de,topRight:de,bottomLeft:pe,bottomRight:pe},ye={topLeft:de,topRight:pe,bottomLeft:de,bottomRight:pe},xe={topLeft:pe,topRight:pe,bottomLeft:ue,bottomRight:ue},me={topLeft:ue,topRight:ue,bottomLeft:pe,bottomRight:pe},ge={topLeft:pe,topRight:ue,bottomLeft:pe,bottomRight:ue},_e={topLeft:ue,topRight:pe,bottomLeft:ue,bottomRight:pe},ve={createComputedParams:t=>t,attributes:{pos:{type:G.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:G.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:G.pe.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:t,mapAligned:e})=>at([[xt.bg,t],[xt.ti,!!e]])},zoomRange:{type:G.pe.UNSIGNED_SHORT,count:2,packPrecisionFactor:a.fq,packTessellation:({minZoom:t,maxZoom:e})=>[t||0,e||28]},offset:{type:G.pe.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:t})=>{const{bottomLeft:e,bottomRight:r,topLeft:i,topRight:n}=t;return[i,n,e,r]}}},textureUV:{type:G.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:t})=>{const{bottomLeft:e,bottomRight:r,topLeft:i,topRight:n}=t;return[i,n,e,r]}}},color:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:t})=>t},fontSize:{type:G.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t})=>(0,J.Lz)(t)},referenceSize:{type:G.pe.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t},{referenceSize:e})=>(0,J.Lz)(e??t)},haloColor:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:t})=>ct(t)},haloFontSize:{type:G.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:t})=>(0,J.Lz)(t)},clipAngle:{type:G.pe.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:t})=>we(t||0)},referenceSymbol:{type:G.pe.BYTE,count:4,packPrecisionFactor:1,packTessellation:(t,e)=>{if(!t.referenceBounds)return[0,0,0,0];const r=(0,Gt.iT)(e.horizontalAlignment),i=(0,Gt.Dy)(e.verticalAlignment),{offsetX:n,offsetY:s,size:o}=t.referenceBounds;return[(0,J.Lz)(n),-(0,J.Lz)(s),(0,J.Lz)(o),r+1<<2|i+1]}}}};class be extends K{constructor(){super(...arguments),this.vertexSpec=ve,this._textMeshParamsPropsInitialized=!1}ensurePacked(t,e,r){super.ensurePacked(t,e,r),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new ce(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(t,e,r){const i=this._getShaping();if(!i)return;const n=e.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(t,e,i,r);if(r&&r.nextPath())return r.nextPoint(),this._writeGlyphs(t,n,r.x,r.y,i,0);if("esriGeometryPolygon"===e.geometryType){const r=e.readCentroidForDisplay();if(!r)return;const[s,o]=r.coords;return this._writeGlyphs(t,n,s,o,i,0)}if("esriGeometryMultipoint"===e.geometryType){const r=e.readGeometryForDisplay();return void r?.forEachVertex(((e,r)=>this._writeGlyphs(t,n,e,r,i,0)))}const s=e.readXForDisplay(),o=e.readYForDisplay();return this._writeGlyphs(t,n,s,o,i,0)}_writePlacedTextMarkers(t,e,r,i){const n=i??B.z.fromFeatureSetReaderCIM(e);if(!n)return;const s=se.getPlacement(n,-1,this.evaluatedMeshParams.placement,(0,J.Lz)(1),t.id,$());if(!s)return;const o=e.getDisplayId();let a=s.next();for(;null!=a;){const e=a.tx,i=-a.ty,n=-a.getAngle();this._writeGlyphs(t,o,e,i,r,n),a=s.next()}}_getShaping(){const t=this._textMeshTransformProps,e=this.evaluatedMeshParams;if(!e.glyphs?.glyphs.length)return null;const r=Math.round((0,J.Lz)(t.fontSize)),i=(0,J.Lz)(t.offsetX),n=(0,J.Lz)(t.offsetY),s=(0,ie.qE)((0,J.Lz)(e.lineWidth),32,512),o=a.DY*(0,ie.qE)(e.lineHeightRatio,.25,4);return(0,oe.Tl)(e.glyphs,{scale:r/a.eG,angle:t.postAngle,xOffset:i,yOffset:n,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:s,lineHeight:o,decoration:e.decoration,borderLineSizePx:(0,J.Lz)(e.boxBorderLineSize),hasBackground:!!e.boxBackgroundColor,useCIMAngleBehavior:e.useCIMAngleBehavior})}_writeGlyphs(t,e,r,i,n,s,o){const a=this.evaluatedMeshParams,c=this._textMeshTransformProps,u=c.fontSize,l=(0,J.Lz)(c.offsetX),h=(0,J.Lz)(c.offsetY);0!==s&&n.setRotation(s);const d=n.bounds,p=r+d.x+l,f=i+d.y-h,y=2*(a.minPixelBuffer?a.minPixelBuffer/u:1),x=Math.max(d.width,d.height)*y;n.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),t.recordBounds(p,f,x,x),this._writeTextBox(t,e,r,i,n.textBox,o),t.recordEnd());for(const s of n.glyphs){t.recordStart(this.instanceId,this.attributeLayout,s.textureBinding),t.recordBounds(p,f,x,x);const{texcoords:n,offsets:c}=s;this._writeQuad(t,e,r,i,{texcoords:n,offsets:c,fontSize:u,color:ct(a.color),isBackground:!1,referenceBounds:o}),t.recordEnd()}0!==s&&n.setRotation(-s)}_writeTextBox(t,e,r,i,n,s,o){const a=this.evaluatedMeshParams,{fontSize:c}=this._textMeshTransformProps,{boxBackgroundColor:u,boxBorderLineColor:l}=a,h={isBackground:!0,fontSize:c,referenceBounds:s,...o};u&&(this._writeQuad(t,e,r,i,{texcoords:he,offsets:n.main,color:ct(u),...h}),l||(this._writeQuad(t,e,r,i,{texcoords:xe,offsets:n.top,color:ct(u),...h}),this._writeQuad(t,e,r,i,{texcoords:me,offsets:n.bot,color:ct(u),...h}),this._writeQuad(t,e,r,i,{texcoords:ge,offsets:n.left,color:ct(u),...h}),this._writeQuad(t,e,r,i,{texcoords:_e,offsets:n.right,color:ct(u),...h}))),l&&(this._writeQuad(t,e,r,i,{texcoords:fe,offsets:n.top,color:ct(l),...h}),this._writeQuad(t,e,r,i,{texcoords:fe,offsets:n.bot,color:ct(l),...h}),this._writeQuad(t,e,r,i,{texcoords:ye,offsets:n.left,color:ct(l),...h}),this._writeQuad(t,e,r,i,{texcoords:ye,offsets:n.right,color:ct(l),...h}))}_writeQuad(t,e,r,i,n){const s=t.vertexCount();this._writeVertex(t,e,r,i,n),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2)}}const we=t=>Math.round(t*(254/360)),Se=(0,$t.Bj)((t=>{let e=0;if(0===t)return 1/0;for(;!(t%2);)e++,t/=2;return e})),Pe={createComputedParams:t=>t,attributes:{...Pt.attributes,bitset:{type:G.pe.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:t,shouldScaleDash:e,isSDF:r})=>at([[xt.cn,t],[xt.kx,e],[xt.b5,r]])},tlbr:{type:G.pe.UNSIGNED_SHORT,count:4,pack:({sprite:t})=>{const{rect:e,width:r,height:i}=t,n=e.x+a.hM,s=e.y+a.hM;return[n,s,n+r,s+i]}},accumulatedDistance:{type:G.pe.UNSIGNED_SHORT,count:1,packTessellation:({distance:t})=>t},segmentDirection:{type:G.pe.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:t,directionY:e})=>[t,e]}}};var Me=r(53334);class Te{static from(t){return"width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(t){const e=new Te(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects),{type:r,width:i,height:n,angle:s,outlineSize:o,referenceSize:a,sprite:c,overrideOutlineColor:u}=t;return e.rawWidth=(0,J.Lz)(i),e.rawHeight=(0,J.Lz)(n),e.angle=s,e.outlineSize=(0,J.Lz)(o),e.referenceSize=(0,J.Lz)(a),e.overrideOutlineColor=u,e.offsetX=(0,J.Lz)(t.offsetX),e.offsetY=(0,J.Lz)(t.offsetY),"simple"!==r||c.sdf||(e.rawWidth=c.width,e.rawHeight=c.height),e.sizeRatio=c.sdf?2:1,e._computeSize(t,!1),e}static fromComplexMeshParams(t){const e=new Te(t.sprite,t.color,t.outlineColor,t.minPixelBuffer,t.placement,t.scaleInfo,t.effects);let{alignment:r,transforms:i,size:n,scaleX:s,anchorX:o,anchorY:a,angle:c,colorLocked:u,frameHeight:l,widthRatio:h,offsetX:d,offsetY:p,outlineSize:f,referenceSize:y,scaleFactor:x,sizeRatio:m,isAbsoluteAnchorPoint:g,rotateClockwise:_,scaleSymbolsProportionally:v,sprite:b}=t;if(i&&i.infos.length>0){const t=(0,ae.zb)(n,c,_,d,p,i);n=t.size,c=t.rotation,d=t.offsetX,p=t.offsetY,_=!1}x&&(n*=x,d*=x,p*=x);const w=s*(b.width/b.height);e.alignment=r,e.rawHeight=(0,J.Lz)(n),e.rawWidth=e.rawHeight*w,e.referenceSize=(0,J.Lz)(y),e.sizeRatio=m,e.angle=c,e.rotateClockwise=_,e.anchorX=o,e.anchorY=a,e.offsetX=(0,J.Lz)(d),e.offsetY=(0,J.Lz)(p),g&&n&&(b.sdf?e.anchorX=o/(n*h):e.anchorX=o/(n*w),e.anchorY=a/n);const S=v&&l?n/l:1;return e.outlineSize=0===f||isNaN(f)?0:(0,J.Lz)(f)*S,e.scaleSymbolsProportionally=v,e.colorLocked=u,e._computeSize(t,!0),e}constructor(t,e,r,i,n,s,o){this.sprite=t,this.color=e,this.outlineColor=r,this.minPixelBuffer=i,this.placement=n,this.scaleInfo=s,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=nt.C1.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,e){const{sprite:r,hasSizeVV:i}=t,n=!!r.sdf,{rawWidth:s,rawHeight:o,sizeRatio:c,outlineSize:u}=this,l=s*c,h=o*c;if(n&&!i){const t=e&&s>o?l:s,r=o,i=u+2;this.computedWidth=Math.min(t+i,l),this.computedHeight=Math.min(r+i,h)}else this.computedWidth=l,this.computedHeight=h;const d=n?a._j/Math.max(l,h):1,p=.5*(l-this.computedWidth)*d,f=.5*(h-this.computedHeight)*d,y=r.rect.x+a.hM+p,x=r.rect.y+a.hM+f,m=y+r.width-2*p,g=x+r.height-2*f;this.texXmin=Math.floor(y),this.texYmin=Math.floor(x),this.texXmax=Math.ceil(m),this.texYmax=Math.ceil(g),this.computedWidth*=(this.texXmax-this.texXmin)/(m-y),this.computedHeight*=(this.texYmax-this.texYmin)/(g-x),this.anchorX*=l/this.computedWidth,this.anchorY*=h/this.computedHeight}}var ke=r(49093);const Ie=3.14159265359/180,ze=128/Math.PI;const Ne={createComputedParams:t=>Te.from(t),attributes:{pos:{type:G.pe.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:G.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:G.pe.UNSIGNED_BYTE,count:1,pack:({sprite:t,alignment:e,scaleSymbolsProportionally:r,overrideOutlineColor:i,colorLocked:n})=>{let s=0;return t.sdf&&(s|=ot(ke.c.bitset.isSDF)),e===nt.C1.MAP&&(s|=ot(ke.c.bitset.isMapAligned)),r&&(s|=ot(ke.c.bitset.scaleSymbolsProportionally)),i&&(s|=ot(ke.c.bitset.overrideOutlineColor)),n&&(s|=ot(ke.c.bitset.colorLocked)),s}},zoomRange:{type:G.pe.SHORT,count:2,packPrecisionFactor:a.fq,pack:({scaleInfo:t},{tileInfo:e})=>st(t,e)},offset:{type:G.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:t,computedWidth:e,computedHeight:r,anchorX:i,anchorY:n,offsetX:s,offsetY:o,rotateClockwise:a})=>{const c=function(t,e,r,i,n=!1){const s=(0,Yt.vt)(),o=n?1:-1;return t?(0,Ut.$0)(s,o*Ie*t):(0,Ut.D_)(s),(e||r)&&(0,Ut.Tl)(s,s,[e,-r]),i&&(0,Ut.e$)(s,s,o*Ie*-i),s}(0,s,o,-t,a),u=-(.5+i)*e,l=-(.5-n)*r,h=[u,l],d=[u+e,l],p=[u,l+r],f=[u+e,l+r];return(0,Me.l0)(h,h,c),(0,Me.l0)(d,d,c),(0,Me.l0)(p,p,c),(0,Me.l0)(f,f,c),[h,d,p,f]}}},textureUV:{type:G.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:t,texXmin:e,texYmax:r,texYmin:i})=>[[e,i],[t,i],[e,r],[t,r]]}},color:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>ct(t)},outlineColor:{type:G.pe.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:t})=>ct(t)},sizing:{type:G.pe.UNSIGNED_BYTE,count:4,pack:({rawWidth:t,rawHeight:e,outlineSize:r,referenceSize:i})=>[ut(Math.max(t,e),128),ut(r,128),ut(i,128),0]},placementAngle:{type:G.pe.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:t})=>function(t){return function(t,e){return t%=256,Math.abs(t>=0?t:t+256)}(t*ze)}(t)},sizeRatio:{type:G.pe.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:t})=>t}}},Ee={createComputedParams:t=>t,attributes:{pos:{type:G.pe.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:G.pe.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:G.pe.UNSIGNED_BYTE,count:1,pack:t=>0},offset:{type:G.pe.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:t})=>{const e=(0,J.Lz)(t),r=-e/2,i=-e/2;return[[r,i],[r+e,i],[r,i+e],[r+e,i+e]]}}},texCoords:{type:G.pe.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:G.pe.UNSIGNED_BYTE,count:2,pack:({size:t})=>[t,t]},referenceSize:{type:G.pe.UNSIGNED_BYTE,count:1,pack:({size:t})=>(0,J.Lz)(t)},zoomRange:{type:G.pe.UNSIGNED_BYTE,count:2,pack:({scaleInfo:t},{tileInfo:e})=>st(t,e)}}},Ae=function(t){const e={};for(const r in t){const i={name:r,constructor:t[r]};e[r]=i}return e}({FillMeshWriter:pt,DotDensityMeshWriter:class extends j{constructor(){super(...arguments),this.vertexSpec=Q}createTesselationParams(t){return{inverseArea:1/t.readGeometryArea()}}},ComplexFillMeshWriter:class extends yt{constructor(){super(...arguments),this.vertexSpec=bt}},PatternFillMeshWriter:yt,OutlineFillMeshWriter:Nt,PatternOutlineFillMeshWriter:class extends Nt{constructor(){super(...arguments),this.vertexSpec=Vt}_createOutlineWriter(t,e,r,i){return new Rt(t,e,r,i)}_write(t,e,r){const i=r?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);if(!n)return;const s=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,B.z.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,r){super.ensurePacked(t,e,r),this._lineMeshWriter.ensurePacked(t,e,r)}enqueueRequest(t,e,r){super.enqueueRequest(t,e,r),this._lineMeshWriter.enqueueRequest(t,e,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}},ComplexOutlineFillMeshWriter:class extends Nt{constructor(){super(...arguments),this.vertexSpec=Ft}_createOutlineWriter(t,e,r,i){return new Dt(t,e,r,i)}_write(t,e,r){const i=r?.asOptimized()??e.readGeometryForDisplay(),n=this._clip(i);if(!n)return;const s=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(t,e,n),this._lineMeshWriter.writeLineVertices(t,B.z.fromOptimizedCIM(n,"esriGeometryPolyline"),e),t.recordEnd()}ensurePacked(t,e,r){super.ensurePacked(t,e,r),this._lineMeshWriter.ensurePacked(t,e,r)}enqueueRequest(t,e,r){super.enqueueRequest(t,e,r),this._lineMeshWriter.enqueueRequest(t,e,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}},MarkerMeshWriter:class extends K{constructor(){super(...arguments),this.vertexSpec=Ne}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(t,e,r){const i=this.evaluatedMeshParams.sprite?.textureBinding,n=e.getDisplayId();t.recordStart(this.instanceId,this.attributeLayout,i);const s=this.evaluatedMeshParams.minPixelBuffer,o=Math.max(this.evaluatedMeshParams.computedWidth,s),a=Math.max(this.evaluatedMeshParams.computedHeight,s),c=this.evaluatedMeshParams.offsetX,u=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(t,e,r,o,a);else if(r&&r.nextPath()){r.nextPoint();const e=r.x,i=r.y;t.recordBounds(e+c,i+u,o,a),this._writeQuad(t,n,e,i)}else if("esriGeometryPolygon"===e.geometryType){const r=e.readCentroidForDisplay();if(!r)return;const[i,s]=r.coords;t.recordBounds(i+c,s+u,o,a),this._writeQuad(t,n,i,s)}else if("esriGeometryPoint"===e.geometryType){const r=e.readXForDisplay(),i=e.readYForDisplay();t.recordBounds(r+c,i+u,o,a),this._writeQuad(t,n,r,i)}else{const r=e.readGeometryForDisplay();r?.forEachVertex(((e,r)=>{t.recordBounds(e+c,r+u,o,a),Math.abs(e)>Ht.s||Math.abs(r)>Ht.s||this._writeQuad(t,n,e,r)}))}t.recordEnd()}_writePlacedMarkers(t,e,r,i,n){const s=r??B.z.fromFeatureSetReaderCIM(e)?.clone();if(!s)return;const o=se.getPlacement(s,-1,this.evaluatedMeshParams.placement,(0,J.Lz)(1),t.id,$());if(!o)return;const a=e.getDisplayId();let c=o.next();const u=this.evaluatedMeshParams.offsetX,l=-this.evaluatedMeshParams.offsetY;for(;null!=c;){const e=c.tx,r=-c.ty;if(Math.abs(e)>Ht.s||Math.abs(r)>Ht.s){c=o.next();continue}const s=-c.getAngle();t.recordBounds(e+u,r+l,i,n),this._writeQuad(t,a,e,r,s),c=o.next()}}_writeQuad(t,e,r,i,n){const s=t.vertexCount(),o=null==n?null:{placementAngle:n};this._writeVertex(t,e,r,i,o),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2)}},PieChartMeshWriter:class extends K{constructor(){super(...arguments),this.vertexSpec=Ee}_write(t,e){const r=e.getDisplayId(),i=this.evaluatedMeshParams.minPixelBuffer,n=Math.max((0,J.Lz)(this.evaluatedMeshParams.size),i);let s,o;if("esriGeometryPoint"===e.geometryType)s=e.readXForDisplay(),o=e.readYForDisplay();else{const t=e.readCentroidForDisplay();if(!t)return;s=t?.coords[0],o=t?.coords[1]}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(s,o,n,n);const a=t.vertexCount();this._writeVertex(t,r,s,o),t.indexWrite(a+0),t.indexWrite(a+1),t.indexWrite(a+2),t.indexWrite(a+1),t.indexWrite(a+3),t.indexWrite(a+2),t.recordEnd()}},TextMeshWriter:be,LineMeshWriter:Tt,TexturedLineMeshWriter:class extends Tt{constructor(t,e,r,i){super(t,e,r,i),this.vertexSpec=Pe,this._tessellationOptions.textured=!0}_write(t,e,r){const i=r??B.z.fromFeatureSetReaderCIM(e);if(!i)return;const{sprite:n}=this.evaluatedMeshParams;this._writeGeometry(t,e,i,n?.textureBinding)}},HeatmapMeshWriter:class extends K{constructor(){super(...arguments),this.vertexSpec=Ot}_write(t,e){t.recordStart(this.instanceId,this.attributeLayout);const r=e.getDisplayId();if("esriGeometryPoint"===e.geometryType){const i=e.readXForDisplay(),n=e.readYForDisplay();this._writeQuad(t,r,i,n)}else if("esriGeometryMultipoint"===e.geometryType){const i=e.readGeometryForDisplay();i?.forEachVertex(((e,i)=>{e>=0&&e<=512&&i>=0&&i<=512&&this._writeQuad(t,r,e,i)}))}t.recordEnd()}_writeQuad(t,e,r,i){const n=t.vertexCount();this._writeVertex(t,e,r,i),t.indexWrite(n+0),t.indexWrite(n+1),t.indexWrite(n+2),t.indexWrite(n+1),t.indexWrite(n+3),t.indexWrite(n+2)}},LabelMeshWriter:class extends be{constructor(){super(...arguments),this._zoomLevel=0}_write(t,e,r,i){if(this._zoomLevel=i||0,null!=r)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(e.geometryType){case"esriGeometryPoint":{const r=e.readXForDisplay(),i=e.readYForDisplay();return this._writePoint(t,r,i,e)}case"esriGeometryEnvelope":case"esriGeometryPolygon":case"esriGeometryMultipoint":{const r=e.readCentroidForDisplay();if(!r)return;const[i,n]=r.coords;return this._writePoint(t,i,n,e)}case"esriGeometryPolyline":{const r=e.readLegacyGeometryForDisplay();this._writeLines(t,e,r)}}}_writePoint(t,e,r,i){const n=this._getShaping();if(!n)return;let s=this._getPointReferenceBounds();s||(s={offsetX:0,offsetY:0,size:0});const o=n.boundsT,a=(0,Gt.xy)(this.evaluatedMeshParams.horizontalAlignment),c=(0,Gt.UD)(this.evaluatedMeshParams.verticalAlignment),u=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0,h=(0,Zt.Q4)(i.getDisplayId());t.metricStart(new Wt.f(h,e,r,a,c,u,l,s)),t.metricBoxWrite(o),this._writeGlyphs(t,i.getDisplayId(),e,r,n,0,s),t.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const t of this._references){const e=t.getBoundsInfo();if(e)return e}return null}_writeLines(t,e,r){const{repeatLabel:i,scaleInfo:n}=this.evaluatedMeshParams,s=this.evaluatedMeshParams.repeatLabelDistance||128,o=this._getShaping();if(!o)return;this._current={out:t,id:e.getDisplayId(),shaping:o,zoomRange:st(n,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0}};const a=function(t,e){const r=e;for(let e=0;e<t.length;e++){let i=t[e];re(i,r);const n=[];n.push(i[0]);for(let t=1;t<i.length;t++){const[e,r]=i[t-1],[s,o]=i[t],a=s-e,c=o-r;n.push([a,c])}t[e]=n,i=n}return t}(r.paths,o.bounds.width),c=this._placeSubdivGlyphs.bind(this),u=(o.bounds.width+s)/2;for(const t of a)ee(t,u,c,!!i)}_placeSubdivGlyphs(t,e,r,i){const{allowOverrun:n,labelPosition:s,repeatLabelDistance:o}=this.evaluatedMeshParams,a=this._current.zoomRange[0],c=Se(e),u=this._current.shaping.bounds.width/2,l=Math.sqrt(o||128)/2,h=Math.min(r,i-r),d=this._current.shaping.isMultiline?28:Math.log2(h/(l+u/2)),p=0===e?d:Math.min(c,d),f=Math.max(a,this._zoomLevel+1-p),y=this._zoomLevel-f,x=this._current.shaping.bounds.width/2*2**y;this._current.shaping.isMultiline?0===e&&this._placeStraight(t,f):n&&y<0?this._placeStraightAlong(t,a):"parallel"===s?this._placeStraightAlong(t,f):"curved"===s&&this._placeCurved(t,f,x)}_placeStraight(t,e){const{out:r,id:i,shaping:n,zoomRange:s,referenceBounds:o}=this._current,{x:a,y:c}=t,u=t.angle*(180/Math.PI)%360,l=(t.angle*(180/Math.PI)+180)%360;if(n.textBox){const a=Math.max(e,s[0],0),c=Math.min(28,s[1]),h=(0,Ut.$0)((0,Yt.vt)(),-t.angle),[d,p]=n.shapeBackground(h),f={minZoom:a,maxZoom:c,clipAngle:u,mapAligned:!0,isLineLabel:!0};r.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(r,i,t.x,t.y,p,o,f),r.recordEnd(),f.clipAngle=l,r.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(r,i,t.x,t.y,p,o,f),r.recordEnd()}const h=(0,Zt.Q4)(i),d=this.evaluatedMeshParams.scaleInfo?.maxScale??0,p=this.evaluatedMeshParams.scaleInfo?.minScale??0;r.metricStart(new Wt.f(h,t.x,t.y,0,0,d,p,null)),r.metricBoxWrite(n.bounds);for(const h of n.glyphs)h.minZoom=e,h.maxZoom=s[1],h.angle=t.angle,this._writeLineGlyph(r,i,a,c,n.bounds,h,u,o,!0),h.angle=t.angle+Math.PI,this._writeLineGlyph(r,i,a,c,n.bounds,h,l,o,!0);r.metricEnd()}_placeCurved(t,e,r){const{out:i,id:n}=this._current,s=t.clone(),o=t.angle*(180/Math.PI)%360,a=(t.angle*(180/Math.PI)+180)%360,c=(0,Zt.Q4)(n),u=this.evaluatedMeshParams.scaleInfo?.maxScale??0,l=this.evaluatedMeshParams.scaleInfo?.minScale??0;i.metricStart(new Wt.f(c,t.x,t.y,0,0,u,l,null)),this._placeFirst(s,e,1,o),this._placeBack(t,s,e,r,1,o),this._placeForward(t,s,e,r,1,o),this._placeFirst(s,e,0,a),this._placeBack(t,s,e,r,0,a),this._placeForward(t,s,e,r,0,a),i.metricEnd()}_placeStraightAlong(t,e){const{out:r,id:i,shaping:n,zoomRange:s,referenceBounds:o}=this._current,{boxBorderLineColor:a,boxBackgroundColor:c}=this.evaluatedMeshParams,u=t.clone(),l=t.angle*(180/Math.PI)%360,h=(t.angle*(180/Math.PI)+180)%360;if(n.glyphs.length>0&&(a||c)){const a=Math.max(e,s[0],0),c=Math.min(28,s[1]),u=(0,Ut.$0)((0,Yt.vt)(),-t.angle),[d,p]=n.shapeBackground(u),f={minZoom:a,maxZoom:c,clipAngle:l,mapAligned:!0,isLineLabel:!0};r.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(r,i,t.x,t.y,p,o,f),r.recordEnd(),f.clipAngle=h,r.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),this._writeTextBox(r,i,t.x,t.y,p,o,f),r.recordEnd()}const d=(0,Zt.Q4)(i),p=this.evaluatedMeshParams.scaleInfo?.maxScale??0,f=this.evaluatedMeshParams.scaleInfo?.minScale??0;r.metricStart(new Wt.f(d,t.x,t.y,0,0,p,f,null)),this._placeFirst(u,e,1,l,!0),this._placeFirst(u,e,0,h,!0),r.metricEnd()}_placeBack(t,e,r,i,n,s){const o=t.clone();let a=t.backwardLength+0;for(;o.prev()&&!(a>=i);)this._placeOnSegment(o,e,a,r,-1,n,s),a+=o.length+0}_placeForward(t,e,r,i,n,s){const o=t.clone();let a=t.remainingLength+0;for(;o.next()&&!(a>=i);)this._placeOnSegment(o,e,a,r,1,n,s),a+=o.length+0}_placeFirst(t,e,r,i,n=!1){const s=t,{out:o,id:a,shaping:c,zoomRange:u,referenceBounds:l}=this._current,h=c.glyphs;for(const d of h){const h=d.x>c.bounds.x?r:1-r,p=h*t.remainingLength+(1-h)*t.backwardLength,f=Math.abs(d.x+d.width/2-c.bounds.x),y=Math.max(0,this._zoomLevel+Math.log2(f/(p+0))),x=Math.max(e,n?0:y);d.maxZoom=Math.min(u[1],28),d.angle=t.angle+(1-r)*Math.PI,d.minZoom=Math.max(u[0],x),o.metricBoxWrite(d.bounds),this._writeLineGlyph(o,a,s.x,s.y,c.bounds,d,i,l,!0)}}_placeOnSegment(t,e,r,i,n,s,o){const{out:a,id:c,shaping:u,referenceBounds:l}=this._current,h=u.glyphs,d=t.dx/t.length,p=t.dy/t.length,f={x:t.x+r*-n*d,y:t.y+r*-n*p};for(const e of h){const h=e.x>u.bounds.x?s:1-s;if(!(h&&1===n||!h&&-1===n))continue;const d=Math.abs(e.x+e.width/2-u.bounds.x),p=Math.max(0,this._zoomLevel+Math.log2(d/r)-.1),y=Math.max(i,this._zoomLevel+Math.log2(d/(r+t.length+0)));0!==p&&(e.angle=t.angle+(1-s)*Math.PI,e.minZoom=y,e.maxZoom=p,this._writeLineGlyph(a,c,f.x,f.y,u.bounds,e,o,l,!0))}}_writeLineGlyph(t,e,r,i,n,s,o,a,c){const u=r+n.x,l=i+n.y,h=2*(this.evaluatedMeshParams.minPixelBuffer?this.evaluatedMeshParams.minPixelBuffer/this._textMeshTransformProps.fontSize:1),d=Math.max(n.width,n.height)*h;t.recordStart(this.instanceId,this.attributeLayout,s.textureBinding),t.recordBounds(u,l,d,d);const{texcoords:p,offsets:f}=s,y=this._textMeshTransformProps.fontSize;this._writeQuad(t,e,r,i,{texcoords:p,offsets:f,fontSize:y,color:ct(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:a,minZoom:Math.max(this._current.zoomRange[0],s.minZoom),maxZoom:Math.min(this._current.zoomRange[1],s.maxZoom),clipAngle:o,mapAligned:c,isLineLabel:!0}),t.recordEnd()}}})},11069:(t,e,r)=>{function i(t){return t}function n(t){return t}r.d(e,{P:()=>i,U:()=>n})},78906:(t,e,r)=>{r.d(e,{f_:()=>x,$Z:()=>f,DM:()=>y,rz:()=>p});var i=r(82392),n=r(22589),s=r(37614),o=r(15871),a=r(6273),c=r(67146);class u extends s.k2{getVisualVariableData(t){if(!this._vvData){const e=this.getAttributeDataCoords(t);this._vvData=(0,o.US)(this.visualVariableData,e).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(t){if(!this._uv){const e=(0,c.Kt)(t),r=this.size,i=(0,o.Wh)(e.x),n=(0,o.Wh)(e.y).multiply((0,o.Wh)(256)),s=(0,o.Wh)(e.z).multiply((0,o.Wh)(256)).multiply((0,o.Wh)(256)),a=(0,o.fV)(i.add(n).add(s)),u=(0,o.zi)(a,r),l=a.subtract(u).divide(r);this._uv=new o.ZY(u,l).add(.5).divide(r)}return this._uv}getFilterData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.filterFlags,e).setDebugName("storage0")}getAnimationData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.animation,e).setDebugName("storage1")}getVVData(t){return this.getVisualVariableData(t)}getDataDrivenData0(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven0,e).setDebugName("storage30")}getDataDrivenData1(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven1,e).setDebugName("storage31")}getDataDrivenData2(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.dataDriven2,e).setDebugName("storage32")}getGPGPUData(t){const e=this.getAttributeDataCoords(t);return(0,o.US)(this.gpgpu,e).setDebugName("storage4")}getFilterFlags(t){return(0,a.A)("webgl-ignores-sampler-precision")?(0,o.mk)(this.getFilterData(t).x.multiply((0,o.fV)(255))):this.getFilterData(t).x.multiply((0,o.fV)(255))}getAnimationValue(t){return this.getAnimationData(t).x}getSizeValue(t){return this.getVisualVariableData(t).x}getColorValue(t){return this.getVisualVariableData(t).y}getOpacityValue(t){return this.getVisualVariableData(t).z}getRotationValue(t){return this.getVisualVariableData(t).w}}(0,i._)([(0,s.Pi)(o.z7)],u.prototype,"filterFlags",void 0),(0,i._)([(0,s.Pi)(o.z7)],u.prototype,"animation",void 0),(0,i._)([(0,s.Pi)(o.z7)],u.prototype,"gpgpu",void 0),(0,i._)([(0,s.Pi)(o.z7)],u.prototype,"visualVariableData",void 0),(0,i._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven0",void 0),(0,i._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven1",void 0),(0,i._)([(0,s.Pi)(o.z7)],u.prototype,"dataDriven2",void 0),(0,i._)([(0,s.Pi)(o.nt)],u.prototype,"size",void 0);class l extends s.k2{}(0,i._)([(0,s.Pi)(o.nt)],l.prototype,"activeReasons",void 0),(0,i._)([(0,s.Pi)(o.nt)],l.prototype,"highlightAll",void 0);class h extends s.k2{}(0,i._)([(0,s.Pi)(o.ZY)],h.prototype,"position",void 0),(0,i._)([(0,s.Pi)(o.nt)],h.prototype,"distance",void 0),(0,i._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolDistance",void 0),(0,i._)([(0,s.Pi)(o.nt)],h.prototype,"smallSymbolSizeThreshold",void 0);var d=r(85070);class p extends s.ZA{}(0,i._)([(0,s.C5)(0,o.eB)],p.prototype,"id",void 0),(0,i._)([(0,s.C5)(1,o.nt)],p.prototype,"bitset",void 0),(0,i._)([(0,s.C5)(2,o.ZY)],p.prototype,"pos",void 0);class f extends s.Y7{}(0,i._)([(0,s.C5)(14,o.ZY)],f.prototype,"nextPos1",void 0),(0,i._)([(0,s.C5)(15,o.ZY)],f.prototype,"nextPos2",void 0);class y extends s.HS{}class x extends s.A{clip(t,e){let r=new o.nt(0);const i=this.storage.getFilterFlags(t);if(r=r.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,c.i6)(i,0)))),this.inside?r=r.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract((0,c.i6)(i,1)))):this.outside?r=r.add((0,o.fV)(2).multiply((0,c.i6)(i,1))):this.highlight&&(r=r.add((0,o.fV)(2).multiply((0,o.fV)(1).subtract(this._checkHighlight(i))))),null!=e){const t=new o.nt(1).subtract((0,o.PM)(e.x,this.view.currentZoom)),i=(0,o.PM)(e.y,this.view.currentZoom);r=r.add(new o.nt(2).multiply(t.add(i)))}return r}getFragmentOutput(t,e,r=new o.nt(1/255)){const i=new s.mm;return i.glFragColor=this._maybeWriteHittest(e)??this._maybeHighlight(t,r)??t,i}_maybeHighlight(t,e){return this.highlight?new o.Zb(t.rgb,(0,o.PM)(e,t.a)):null}_checkHighlight(t){let e=this._checkHighlightBit(t,0);for(let r=1;r<n.M$.length;r++)e=e.add(this._checkHighlightBit(t,r));return(0,o.PM)(new o.nt(.1),e.add(this.highlight.highlightAll))}_checkHighlightBit(t,e){return(0,c.yS)(t,e).multiply((0,c.mh)(this.highlight.activeReasons,e))}maybeRunHittest(t,e,r){if(null==this.hittestRequest)return null;const i=this.hittest(t,e,r);let n=(0,o.Tk)((0,o.MM)(i,this.hittestRequest.distance),new o.nt(2),new o.nt(0));const s=this.storage.getAttributeDataCoords(t.id),a=(0,c.nb)(s);n=n.add(this.clip(t.id,t.zoomRange));const u=new o.Zb(new o.nt(1/255),0,0,0);return{glPointSize:new o.nt(1),glPosition:new o.Zb(a,n,1),color:u}}_maybeWriteHittest(t){return null!=this.hittestRequest?t.color:null}}(0,i._)([s.E8],x.prototype,"inside",void 0),(0,i._)([s.E8],x.prototype,"outside",void 0),(0,i._)([(0,s.uK)(l)],x.prototype,"highlight",void 0),(0,i._)([(0,s.Pi)(u)],x.prototype,"storage",void 0),(0,i._)([(0,s.Pi)(d.o)],x.prototype,"view",void 0),(0,i._)([(0,s.uK)(h)],x.prototype,"hittestRequest",void 0)},21443:(t,e,r)=>{r.d(e,{Bh:()=>x,KP:()=>y,Ps:()=>m});var i=r(82392),n=r(6538),s=r(37614),o=r(15871),a=r(78906),c=r(77330),u=r(13607),l=r(25767),h=r(60567),d=r(67146);class p extends u._{}(0,i._)([(0,s.C5)(5,o.Zb)],p.prototype,"tlbr",void 0),(0,i._)([(0,s.C5)(6,o.nt)],p.prototype,"width",void 0),(0,i._)([(0,s.C5)(7,o.nt)],p.prototype,"height",void 0),(0,i._)([(0,s.C5)(8,o.ZY)],p.prototype,"offset",void 0),(0,i._)([(0,s.C5)(9,o.ZY)],p.prototype,"scale",void 0),(0,i._)([(0,s.C5)(10,o.nt)],p.prototype,"angle",void 0);class f extends a.DM{}function y(t,e){const r=(0,o.jh)(new o.ZY(1),new o.ZY(1/n.bg),new o.ZY((0,d.mh)(e.bitset,c.A),(0,d.mh)(e.bitset,c.lx))),i=t.view.requiredZoomFactor,s=new o.ZY(e.width,e.height).multiply(r),a=s.multiply(e.scale).multiply(i),u=e.angle.multiply(c.rp),l=(0,o.F8)(u),h=(0,o.gn)(u),p=function(t,e,r,i,n){const s=(0,o.LC)((0,d.mh)(n,c.Fz),(0,o.fV)(1)),a=(0,d.Rj)(new o.Zb(t,0));return(0,o.Tk)(s,(0,o.w0)(i.divide(e.x),r.divide(e.y),0,(0,o.ze)(r.divide(e.x)),i.divide(e.y),0,(0,d._9)((0,o.Zc)(a,0)),(0,d._9)((0,o.Zc)(0,a)),1),(0,o.w0)(i.divide(e.x),r.divide(e.y),0,(0,o.ze)(r.divide(e.x)),i.divide(e.y),0,0,0,1))}(e.id,a,l,h,e.bitset),f=t.localTileOffset.getPatternOffsetAtTileOrigin(s,l,h),y=i.multiply(e.scale).multiply(e.offset.subtract(f)).divide(a),x=new o.eB(e.pos,1),m=p.multiply(x).xy.subtract(y),g=e.tlbr.divide(t.mosaicInfo.size.xyxy);let _=(0,d.mh)(e.bitset,c.cn);return null!=t.visualVariableColor&&(_=(0,o.Tk)((0,d.M8)(t.storage.getColorValue(e.id)),new o.nt(0),_)),{tileTextureCoord:m,tlbr:g,sampleAlphaOnly:_}}function x(t,e){const r=(0,o.zi)(e.tileTextureCoord,new o.nt(1)),i=(0,o.jh)(e.tlbr.xy,e.tlbr.zw,r);let n=(0,o.US)(t.mosaicInfo.texture,i);return n=(0,o.Tk)((0,o.MM)(e.sampleAlphaOnly,new o.nt(.5)),n.aaaa,n),e.color.multiply(n)}class m extends u.z{vertex(t,e){return{...super.vertex(t,e),...y(this,t)}}fragment(t){const e=x(this,t);return this.getFragmentOutput(e,t,new o.nt(0))}}(0,i._)([(0,s.Pi)(h.b)],m.prototype,"mosaicInfo",void 0),(0,i._)([(0,s.Pi)(l.P)],m.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,s.hF)(p)),(0,i.a)(1,(0,s.hF)(a.$Z))],m.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,s.hF)(f))],m.prototype,"fragment",null)},86049:(t,e,r)=>{r.d(e,{RH:()=>_,cZ:()=>f,v9:()=>x});var i=r(82392),n=r(37614),s=r(15871),o=r(78906),a=r(21443),c=r(84181),u=r(42100),l=r(25767),h=r(60567),d=r(32621),p=r(30827);const f=16,y=1/f,x=128;class m extends o.rz{}(0,i._)([(0,n.C5)(3,s.Zb)],m.prototype,"color",void 0),(0,i._)([(0,n.C5)(4,s.Zb)],m.prototype,"tlbr",void 0),(0,i._)([(0,n.C5)(5,s.nt)],m.prototype,"angle",void 0),(0,i._)([(0,n.C5)(6,s.nt)],m.prototype,"aux1",void 0),(0,i._)([(0,n.C5)(7,s.nt)],m.prototype,"aux2",void 0),(0,i._)([(0,n.C5)(8,s.ZY)],m.prototype,"aux3",void 0),(0,i._)([(0,n.C5)(9,s.ZY)],m.prototype,"aux4",void 0),(0,i._)([(0,n.C5)(10,s.ZY)],m.prototype,"zoomRange",void 0);class g extends p.A1{}class _ extends d.My{vertex(t,e){const{aux1:r,aux2:i,aux3:n,aux4:o}=t,c={...t,width:r,height:i,offset:n,scale:o.multiply(y)},u={...t,halfWidth:r.multiply(y),referenceHalfWidth:i.multiply(y),offset:n.multiply(y),normal:o.subtract(x).multiply(y)},l=(0,d.Yb)(this,u),h=(0,a.KP)(this,c),p=(0,s.MM)(l.isOutline,new s.nt(.5));return{...l,...h,...this.maybeRunHittest(t,e,p)}}fragment(t){const{isOutline:e}=t,r=(0,s.MM)(e,new s.nt(.5)),i=(0,u.o7)(t,this.antialiasingControls.blur),n=(0,a.Bh)(this,t),o=(0,s.Tk)(r,i,n),c=(0,s.Tk)(r,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,c)}hittest(t,e,r){return(0,s.Tk)(r,(0,c.My)(this.hittestRequest),(0,c.Lq)(this,t,e))}}(0,i._)([(0,n.Pi)(h.b)],_.prototype,"mosaicInfo",void 0),(0,i._)([(0,n.Pi)(l.P)],_.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(m)),(0,i.a)(1,(0,n.hF)(o.$Z))],_.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(g))],_.prototype,"fragment",null)},13607:(t,e,r)=>{r.d(e,{_:()=>h,z:()=>d});var i=r(82392),n=r(37614),s=r(15871),o=r(78906),a=r(84181),c=r(2652),u=r(61382),l=r(96878);class h extends o.rz{}(0,i._)([(0,n.C5)(3,s.Zb)],h.prototype,"color",void 0),(0,i._)([(0,n.C5)(4,s.ZY)],h.prototype,"zoomRange",void 0);class d extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const r=(0,l.cF)(this,t.id),i=(0,l.G7)(this,t.id,t.color).multiply(r),n=this.view.displayViewScreenMat3.multiply(new s.eB(t.pos.xy,1)),o=this.clip(t.id,t.zoomRange);return{glPosition:new s.Zb(n.xy,o,1),color:i,...this.maybeRunHittest(t,e,null)}}fragment(t){return this.getFragmentOutput(t.color,t,new s.nt(0))}hittest(t,e){return(0,a.Lq)(this,t,e)}}(0,i._)([(0,n.uK)(c._)],d.prototype,"visualVariableColor",void 0),(0,i._)([(0,n.uK)(u.i)],d.prototype,"visualVariableOpacity",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(h)),(0,i.a)(1,(0,n.hF)(o.$Z))],d.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(o.DM))],d.prototype,"fragment",null)},42100:(t,e,r)=>{r.d(e,{$0:()=>b,Xc:()=>x,cM:()=>S,fF:()=>m,fg:()=>g,o7:()=>w,xw:()=>v});var i=r(82392),n=r(37614),s=r(15871),o=r(78906),a=r(77330),c=r(84181),u=r(2652),l=r(61382),h=r(35935),d=r(44709),p=r(2457),f=r(75575),y=r(96878);class x extends o.rz{}(0,i._)([(0,n.C5)(3,s.Zb)],x.prototype,"color",void 0),(0,i._)([(0,n.C5)(4,s.ZY)],x.prototype,"offset",void 0),(0,i._)([(0,n.C5)(5,s.ZY)],x.prototype,"normal",void 0),(0,i._)([(0,n.C5)(6,s.nt)],x.prototype,"halfWidth",void 0),(0,i._)([(0,n.C5)(7,s.nt)],x.prototype,"referenceHalfWidth",void 0),(0,i._)([(0,n.C5)(8,s.ZY)],x.prototype,"zoomRange",void 0);class m extends o.DM{}class g extends n.k2{}function _(t){return(0,s.T9)(new s.nt(a.Fb).multiply((0,s.PM)(t,new s.nt(a.J5))),new s.nt(1))}function v(t,e){const{halfWidth:r,normal:i}=t,n=_(r),o=(0,s.Bw)(i).multiply(r);return(0,s.qE)(n.multiply(r.subtract(o)).divide(e.add(n).subtract(new s.nt(1))),new s.nt(0),new s.nt(1))}function b(t,e){const{id:r,offset:i,pos:n,normal:o,zoomRange:c}=e,{displayViewScreenMat3:u,displayViewMat3:l}=t.view,h=(0,y.G7)(t,r,e.color),d=(0,y.cF)(t,r),p=function(t,e){const{id:r,halfWidth:i,referenceHalfWidth:n}=e;if((0,y.G5)(t)){const e=new s.nt(2).multiply(n),o=(0,y.Mg)(t,r,e);return new s.nt(.5).multiply(i.divide((0,s.T9)(n,new s.nt(a.Ni)))).multiply(o)}return i}(t,e),f=new s.nt(.5).multiply(t.antialiasingControls.antialiasing),x=(0,s.T9)(p.add(f),new s.nt(.45)).add(new s.nt(.1).multiply(f)),m=_(x).multiply(x).multiply(i),g=l.multiply(new s.eB(m,new s.nt(0))),v=u.multiply(new s.eB(n,new s.nt(1))).add(g),b=new s.nt(2).multiply((0,s.PM)(p,new s.nt(0))).add(t.clip(r,c)),w=new s.Zb(v.xy,b,1);return{color:h,opacity:d,halfWidth:x,normal:o,scaledOffset:m,scaledHalfWidth:p,glPosition:new s.Zb(w.xy,b,1)}}function w(t,e){const{opacity:r,color:i}=t,n=v(t,e);return r.multiply(i).multiply(n)}(0,i._)([(0,n.Pi)(s.nt)],g.prototype,"antialiasing",void 0),(0,i._)([(0,n.Pi)(s.nt)],g.prototype,"blur",void 0);class S extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const r=b(this,t);return{...r,...this.maybeRunHittest(t,e,r.halfWidth)}}fragment(t){const e=w(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,r){const{viewMat3:i,tileMat3:n}=this.view,o=i.multiply(n),a=o.multiply(new s.eB(t.pos,1)),u=o.multiply(new s.eB(e.nextPos1,1)),l=o.multiply(new s.eB(e.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:p}=this.hittestRequest,f=(0,s.PM)(r,p.multiply(.5)).multiply(h.subtract(d)),y=this.hittestRequest.position;return(0,s.jk)((0,c.E2)(y,a.xy,u.xy),(0,c.E2)(y,a.xy,l.xy)).subtract(r).add(f)}}(0,i._)([(0,n.Pi)(g)],S.prototype,"antialiasingControls",void 0),(0,i._)([(0,n.uK)(u._)],S.prototype,"visualVariableColor",void 0),(0,i._)([(0,n.uK)(l.i)],S.prototype,"visualVariableOpacity",void 0),(0,i._)([(0,n.uK)(h.n)],S.prototype,"visualVariableSizeMinMaxValue",void 0),(0,i._)([(0,n.uK)(d.F)],S.prototype,"visualVariableSizeScaleStops",void 0),(0,i._)([(0,n.uK)(p.N)],S.prototype,"visualVariableSizeStops",void 0),(0,i._)([(0,n.uK)(f.d)],S.prototype,"visualVariableSizeUnitValue",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(x)),(0,i.a)(1,(0,n.hF)(o.$Z))],S.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(m))],S.prototype,"fragment",null)},25767:(t,e,r)=>{r.d(e,{P:()=>a});var i=r(82392),n=r(37614),s=r(15871),o=r(77330);class a extends n.k2{getPatternOffsetAtTileOrigin(t,e=new s.nt(0),r=new s.nt(1)){const i=new s.ZY(o.YV).divide(t);let n=t.multiply((0,s.jc)(this.maxIntsToLocalOrigin.multiply(i))).add(this.tileOffsetFromLocalOrigin).subtract(new s.nt(.5).multiply(t));return n=new s.ZY(n.x.multiply(r).subtract(n.y.multiply(e)),n.x.multiply(e).add(n.y.multiply(r))),(0,s.zi)(n,t)}}(0,i._)([(0,n.Pi)(s.ZY)],a.prototype,"tileOffsetFromLocalOrigin",void 0),(0,i._)([(0,n.Pi)(s.ZY)],a.prototype,"maxIntsToLocalOrigin",void 0)},60567:(t,e,r)=>{r.d(e,{b:()=>o});var i=r(82392),n=r(37614),s=r(15871);class o extends n.k2{}(0,i._)([(0,n.Pi)(s.ZY)],o.prototype,"size",void 0),(0,i._)([(0,n.Pi)(s.z7)],o.prototype,"texture",void 0)},32621:(t,e,r)=>{r.d(e,{A7:()=>_,My:()=>b,Yb:()=>v,nj:()=>w,wG:()=>g});var i=r(82392),n=r(37614),s=r(15871),o=r(78906),a=r(77330),c=r(84181),u=r(42100),l=r(67146),h=r(2652),d=r(61382),p=r(35935),f=r(44709),y=r(2457),x=r(75575),m=r(96878);class g extends o.rz{}(0,i._)([(0,n.C5)(3,s.ZY)],g.prototype,"offset",void 0),(0,i._)([(0,n.C5)(4,s.Zb)],g.prototype,"color",void 0),(0,i._)([(0,n.C5)(5,s.ZY)],g.prototype,"normal",void 0),(0,i._)([(0,n.C5)(6,s.nt)],g.prototype,"halfWidth",void 0),(0,i._)([(0,n.C5)(7,s.nt)],g.prototype,"referenceHalfWidth",void 0),(0,i._)([(0,n.C5)(8,s.ZY)],g.prototype,"zoomRange",void 0);class _ extends u.fF{}function v(t,e,r){const{id:i,bitset:n}=e,o=(0,l.mh)(n,a.Xx),c=(0,s.MM)(o,new s.nt(.5)),h=(0,u.$0)(t,e),d=(0,s.Tk)(c,h.halfWidth,new s.nt(0)),p=(0,m.cF)(t,i),f=(0,m.G7)(t,i,e.color),y=(0,s.Tk)(c,e.color,f.multiply(p)),x=t.view.displayViewScreenMat3.multiply(new s.eB(e.pos.xy,1)),g=t.clip(e.id),_=new s.Zb(x.xy,g,1),v=(0,s.Tk)(c,h.glPosition,_),b=r&&t.maybeRunHittest(e,r,c);return{isOutline:o,color:y,opacity:new s.nt(1),halfWidth:d,normal:h.normal,glPosition:v,...b}}class b extends o.f_{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}(0,i._)([(0,n.Pi)(u.fg)],b.prototype,"antialiasingControls",void 0),(0,i._)([(0,n.uK)(h._)],b.prototype,"visualVariableColor",void 0),(0,i._)([(0,n.uK)(d.i)],b.prototype,"visualVariableOpacity",void 0),(0,i._)([(0,n.uK)(p.n)],b.prototype,"visualVariableSizeMinMaxValue",void 0),(0,i._)([(0,n.uK)(f.F)],b.prototype,"visualVariableSizeScaleStops",void 0),(0,i._)([(0,n.uK)(y.N)],b.prototype,"visualVariableSizeStops",void 0),(0,i._)([(0,n.uK)(x.d)],b.prototype,"visualVariableSizeUnitValue",void 0);class w extends b{vertex(t,e){return v(this,t,e)}fragment(t){const{color:e,isOutline:r}=t,i=(0,s.MM)(r,new s.nt(.5)),n=(0,u.o7)(t,this.antialiasingControls.blur),o=(0,s.Tk)(i,n,e),a=(0,s.Tk)(i,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,a)}hittest(t,e,r){return(0,s.Tk)(r,(0,c.My)(this.hittestRequest),(0,c.Lq)(this,t,e))}}(0,i._)([(0,i.a)(0,(0,n.hF)(g)),(0,i.a)(1,(0,n.hF)(o.$Z))],w.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(_))],w.prototype,"fragment",null)},58721:(t,e,r)=>{r.d(e,{_u:()=>d,dW:()=>p,vx:()=>f});var i=r(82392),n=r(37614),s=r(15871),o=r(78906),a=r(13607),c=r(25767),u=r(60567);class l extends a._{}(0,i._)([(0,n.C5)(5,s.Zb)],l.prototype,"tlbr",void 0),(0,i._)([(0,n.C5)(6,s.nt)],l.prototype,"inverseRasterizationScale",void 0);class h extends o.DM{}function d(t,e){const r=e.tlbr.xy,i=e.tlbr.zw,n=i.x.subtract(r.x),o=r.y.subtract(i.y),a=new s.ZY(n,o).multiply(e.inverseRasterizationScale),c=a.multiply(t.view.requiredZoomFactor),u=function(t){const e=new s.nt(1),r=new s.nt(0);return new s.U(e.divide(t.x),r.divide(t.y),0,(0,s.ze)(r.divide(t.x)),e.divide(t.y),0,0,0,1)}(c),l=t.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(c),h=new s.eB(e.pos,1);return{tileTextureCoord:u.multiply(h).xy.subtract(l),tlbr:e.tlbr.divide(t.mosaicInfo.size.xyxy)}}function p(t,e){const r=(0,s.zi)(t.tileTextureCoord,new s.nt(1)),i=(0,s.jh)(t.tlbr.xy,t.tlbr.zw,r),n=(0,s.US)(e.texture,i);return t.color.multiply(n)}class f extends a.z{vertex(t,e){return{...super.vertex(t,e),...d(this,t)}}fragment(t){const e=p(t,this.mosaicInfo);return this.getFragmentOutput(e,t,new s.nt(0))}}(0,i._)([(0,n.Pi)(u.b)],f.prototype,"mosaicInfo",void 0),(0,i._)([(0,n.Pi)(c.P)],f.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(l)),(0,i.a)(1,(0,n.hF)(o.$Z))],f.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(h))],f.prototype,"fragment",null)},30827:(t,e,r)=>{r.d(e,{A1:()=>p,tA:()=>f});var i=r(82392),n=r(37614),s=r(15871),o=r(78906),a=r(42100),c=r(25767),u=r(60567),l=r(32621),h=r(58721);class d extends l.wG{}(0,i._)([(0,n.C5)(9,s.Zb)],d.prototype,"tlbr",void 0),(0,i._)([(0,n.C5)(10,s.nt)],d.prototype,"inverseRasterizationScale",void 0);class p extends l.A7{}class f extends l.nj{vertex(t,e){return{...(0,l.Yb)(this,t,e),...(0,h._u)(this,t)}}fragment(t){const{isOutline:e}=t,r=(0,s.MM)(e,new s.nt(.5)),i=(0,a.o7)(t,this.antialiasingControls.blur),n=(0,h.dW)(t,this.mosaicInfo),o=(0,s.Tk)(r,i,n),c=(0,s.Tk)(r,new s.nt(1/255),new s.nt(0));return this.getFragmentOutput(o,t,c)}}(0,i._)([(0,n.Pi)(u.b)],f.prototype,"mosaicInfo",void 0),(0,i._)([(0,n.Pi)(c.P)],f.prototype,"localTileOffset",void 0),(0,i._)([(0,i.a)(0,(0,n.hF)(d)),(0,i.a)(1,(0,n.hF)(o.$Z))],f.prototype,"vertex",null),(0,i._)([(0,i.a)(0,(0,n.hF)(p))],f.prototype,"fragment",null)},85070:(t,e,r)=>{r.d(e,{o:()=>o});var i=r(82392),n=r(37614),s=r(15871);class o extends n.k2{}(0,i._)([(0,n.Pi)(s.U)],o.prototype,"displayViewScreenMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"displayViewMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"displayMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"viewMat3",void 0),(0,i._)([(0,n.Pi)(s.U)],o.prototype,"tileMat3",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"displayZoomFactor",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"requiredZoomFactor",void 0),(0,i._)([(0,n.Pi)(s.ZY)],o.prototype,"tileOffset",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"currentScale",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"currentZoom",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"metersPerSRUnit",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"rotation",void 0),(0,i._)([(0,n.Pi)(s.nt)],o.prototype,"pixelRatio",void 0)},2652:(t,e,r)=>{r.d(e,{_:()=>a});var i=r(82392),n=r(37614),s=r(15871),o=r(67146);class a extends n.k2{getColor(t,e,r){return(0,s.j1)([(0,s.or)((0,o.M8)(t),r),e],[(0,s.$5)(t,this.values.first()),this.colors.first()],[(0,s.aX)(t,this.values.last()),this.colors.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),r=this.values.get(e),i=e.subtract(1),n=this.values.get(i),o=t.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.colors.get(i),this.colors.get(e),o)}])}}(0,i._)([(0,n.Pi)(s.My.ofType(s.Zb,8))],a.prototype,"colors",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},61382:(t,e,r)=>{r.d(e,{i:()=>a});var i=r(82392),n=r(37614),s=r(15871),o=r(67146);class a extends n.k2{getOpacity(t){return(0,s.j1)([(0,o.M8)(t),new s.nt(1)],[(0,s.$5)(t,this.opacityValues.first()),this.opacities.first()],[(0,s.aX)(t,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const e=this.opacityValues.findIndex((e=>(0,s.MM)(e,t))),r=this.opacityValues.get(e),i=e.subtract(1),n=this.opacityValues.get(i),o=t.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.opacities.get(i),this.opacities.get(e),o)}])}}(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacities",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"opacityValues",void 0)},35935:(t,e,r)=>{r.d(e,{n:()=>a});var i=r(82392),n=r(37614),s=r(15871),o=r(67146);class a extends n.k2{getSize(t,e){const r=this.minMaxValueAndSize.xy,i=this.minMaxValueAndSize.zw;return(0,s.Tk)((0,o.M8)(t),e,(()=>{const e=t.subtract(r.x).divide(r.y.subtract(r.x)),n=(0,s.qE)(e,new s.nt(0),new s.nt(1));return i.x.add(n.multiply(i.y.subtract(i.x)))}))}}(0,i._)([(0,n.Pi)(s.Zb)],a.prototype,"minMaxValueAndSize",void 0)},44709:(t,e,r)=>{r.d(e,{F:()=>o});var i=r(82392),n=r(37614),s=r(15871);class o extends n.k2{getSizeForViewScale(t){return(0,s.j1)([(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),r=this.values.get(e),i=e.subtract(1),n=this.values.get(i),o=t.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.sizes.get(i),this.sizes.get(e),o)}])}}(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],o.prototype,"sizes",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],o.prototype,"values",void 0)},2457:(t,e,r)=>{r.d(e,{N:()=>a});var i=r(82392),n=r(37614),s=r(15871),o=r(67146);class a extends n.k2{getSize(t,e){const r=(0,s.j1)([(0,o.M8)(t),e],[(0,s.$5)(t,this.values.first()),this.sizes.first()],[(0,s.aX)(t,this.values.last()),this.sizes.last()],[!0,()=>{const e=this.values.findIndex((e=>(0,s.MM)(e,t))),r=this.values.get(e),i=e.subtract(1),n=this.values.get(i),o=t.subtract(n).divide(r.subtract(n));return(0,s.jh)(this.sizes.get(i),this.sizes.get(e),o)}]);return(0,s.Tk)((0,o.M8)(r),e,r)}}(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"sizes",void 0),(0,i._)([(0,n.Pi)(s.My.ofType(s.nt,8))],a.prototype,"values",void 0)},75575:(t,e,r)=>{r.d(e,{d:()=>a});var i=r(82392),n=r(37614),s=r(15871),o=r(67146);class a extends n.k2{getSize(t,e){return(0,s.Tk)((0,o.M8)(t),e,t.multiply(this.unitValueToPixelsRatio))}}(0,i._)([(0,n.Pi)(s.nt)],a.prototype,"unitValueToPixelsRatio",void 0)},77330:(t,e,r)=>{var i;r.d(e,{$w:()=>l,A:()=>g,Fb:()=>a,Fz:()=>x,H_:()=>i,J5:()=>c,M:()=>d,Ni:()=>h,V5:()=>o,Xx:()=>y,YV:()=>S,au:()=>u,b5:()=>v,bg:()=>b,cn:()=>f,kx:()=>_,lx:()=>m,os:()=>n,qM:()=>p,rp:()=>s,ti:()=>w}),function(t){t[t.Geographic=0]="Geographic",t[t.Arithmatic=1]="Arithmatic"}(i||(i={}));const n=3.14159265359/180,s=3.14159265359/128,o=1,a=1.1,c=1,u=24,l=8,h=1e-5,d=.05,p=1e-30,f=4,y=0,x=2,m=5,g=6,_=2,v=3,b=0,w=3,S=16777216},84181:(t,e,r)=>{r.d(e,{Bo:()=>l,Bs:()=>c,E2:()=>o,Lq:()=>d,My:()=>h,g$:()=>p,kW:()=>a});var i=r(15871),n=r(77330),s=r(67146);function o(t,e,r){const n=r.subtract(e),s=(a=t.subtract(e),c=n,(0,i.Om)(a,(0,i.S8)(c))),o=(0,i.qE)(s.divide((0,i.Bw)(n)),new i.nt(0),new i.nt(1));var a,c;return(0,i.Io)(t,e.add(o.multiply(r.subtract(e))))}function a(t){const e=(0,i.tn)(t);return(0,i.PM)(e.x.add(e.y).add(e.z),new i.nt(1.05))}function c(t,e,r,n){const s=new i.U(r.x.multiply(n.y).subtract(n.x.multiply(r.y)),n.x.multiply(e.y).subtract(e.x.multiply(n.y)),e.x.multiply(r.y).subtract(r.x.multiply(e.y)),r.y.subtract(n.y),n.y.subtract(e.y),e.y.subtract(r.y),n.x.subtract(r.x),e.x.subtract(n.x),r.x.subtract(e.x)),o=e.x.multiply(r.y.subtract(n.y)),a=r.x.multiply(n.y.subtract(e.y)),c=n.x.multiply(e.y.subtract(r.y)),u=o.add(a).add(c);return new i.nt(1).divide(u).multiply(s.multiply(new i.eB(1,t)))}function u(t,e,r,n){return(0,i.LC)(a(c(t,e,r,n)),new i.nt(1))}function l(t,e,r,a){const c=r.subtract(e),l=a.subtract(e),h=(0,s.tL)(c,l),d=(0,i.Uo)((0,i.Xe)(h,new i.nt(n.M)),(0,i.MM)(h,new i.nt(-n.M)));return(0,i.j1)([(0,i.Uo)((0,i.AU)(d),u(t.xy,e,r,a)),new i.nt(-1)],[!0,()=>{const n=o(t,e,r),s=o(t,r,a),c=o(t,a,e);return(0,i.jk)((0,i.jk)(n,s),c)}])}function h(t){return t.distance.add(1)}function d(t,e,r){const{viewMat3:n,tileMat3:s}=t.view,o=n.multiply(s),a=o.multiply(new i.eB(e.pos,1)),c=o.multiply(new i.eB(r.nextPos1,1)),u=o.multiply(new i.eB(r.nextPos2,1));return l(t.hittestRequest.position,a.xy,c.xy,u.xy)}function p(t,e,r){return(0,i.Io)(t,r).subtract(e)}},67146:(t,e,r)=>{r.d(e,{K5:()=>h,Kt:()=>f,M8:()=>a,Rj:()=>y,_9:()=>o,i6:()=>d,mh:()=>l,nb:()=>u,tL:()=>c,xf:()=>x,yS:()=>p});var i=r(22589),n=r(15871),s=r(77330);function o(t){const e=(0,n.fV)(12.9898),r=(0,n.fV)(78.233),i=(0,n.fV)(43758.5453),s=(0,n.Om)(t,(0,n.Zc)(e,r)),o=(0,n.zi)(s,(0,n.fV)(3.14));return(0,n.jc)((0,n.F8)(o).multiply(i))}function a(t){return(0,n.LC)(t,(0,n.fV)(s.qM))}function c(t,e){return t.x.multiply(e.y).subtract(e.x.multiply(t.y))}function u(t){return t.multiply(2).subtract(1)}function l(t,e){const r=(0,n.fV)(2**e);return(0,n.zi)((0,n.RI)(t.divide(r)),(0,n.fV)(2))}function h(t,e){return(0,n.MM)(l(t,e),(0,n.fV)(.5))}function d(t,e){return l(t,e+i.M$.length)}function p(t,e){return l(t,e)}function f(t){const e=l(t.z,7),r=(0,n.fV)(1).subtract(e),i=t.xyz.subtract((0,n.eR)(0,0,(0,n.fV)(128)));return r.multiply(t).add(e.multiply(i))}function y(t){const e=(0,n.ln)(255/256,255/65536,255/16777216,255/4294967296);return(0,n.Om)(t,e)}function x(t){return(0,n.T9)((0,n.T9)((0,n.T9)(t.x,t.y),t.z),t.w)}},96878:(t,e,r)=>{r.d(e,{G5:()=>n,G7:()=>o,Mg:()=>s,TL:()=>c,cF:()=>a});var i=r(15871);function n(t){return null!=t.visualVariableSizeMinMaxValue||null!=t.visualVariableSizeScaleStops||null!=t.visualVariableSizeStops||null!=t.visualVariableSizeUnitValue}function s(t,e,r){if(n(t)){const i=t.storage.getSizeValue(e);return t.visualVariableSizeMinMaxValue?.getSize(i,r)??t.visualVariableSizeScaleStops?.getSizeForViewScale(t.view.currentScale)??t.visualVariableSizeStops?.getSize(i,r)??t.visualVariableSizeUnitValue?.getSize(i,r)}return r}function o(t,e,r,n=new i.x(!1)){if(null==t.visualVariableColor)return r;const s=t.storage.getColorValue(e);return t.visualVariableColor.getColor(s,r,n)}function a(t,e){if(null==t.visualVariableOpacity)return new i.nt(1);const r=t.storage.getOpacityValue(e);return t.visualVariableOpacity.getOpacity(r)}function c(t,e){if(null==t.visualVariableRotation)return i.U.identity();const r=t.storage.getRotationValue(e);return t.visualVariableRotation.getVVRotationMat3(r)}},84472:(t,e,r)=>{r.d(e,{K:()=>u});var i=r(62991),n=r(80861),s=r(21750),o=(r(67498),r(6273),r(63103),r(68716),r(49214),r(19980)),a=(r(86424),r(89958),r(82657));function c(t,e,r){const s=e.length;if(s!==r){const o=new i.A("Invalid Uniform",`Invalid length, expected ${r} but got ${s}`,{uniformName:t,values:e});n.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class u{constructor(t,e,r,i,n,s){this._program=null,this._vao=null,this._temporaryTextures=[],this.vertexShader=t,this.fragmentShader=e,this._locations=r,this._locationInfo=i,this._uniformBindings=n,this._transformFeedbackBindings=s}destroy(){this._program&&this._program.dispose(),this.cleanupTemporaryTextures()}get locations(){return this._locations}get locationInfo(){return this._locationInfo}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const e=new Map;for(const[t,r]of this._locations)e.set(t,r);const r=[];for(const t of this._transformFeedbackBindings??[]){const{index:e,propertyKey:i}=t;r[e]=`v_${i}`}this._program=new o.B(t,this.vertexShader,this.fragmentShader,e,new Map,r)}const r=this._program;t.useProgram(r);for(const i of this._uniformBindings){const{shaderModulePath:n,uniformName:o,uniformType:u,uniformArrayLength:l}=i,h=(0,s.wc)(n,e);if(null==h){if("sampler2D"===u)continue;throw new Error(`Failed to find uniform value for ${n}`)}switch("array"===u?i.uniformArrayElementType:u){case"sampler2D":{const{unit:e,texture:i}=h;if(r.setUniform1i(o,e),"type"in i)t.bindTexture(i,e);else{const r=(0,a.sZ)(t,i.descriptor,i.data);t.bindTexture(r,e)}break}case"int":if(!l){r.setUniform1i(o,h);break}c(i.uniformName,h,l),r.setUniform1iv(o,h);break;case"float":if(!l){r.setUniform1f(o,h);break}c(i.uniformName,h,l),r.setUniform1fv(o,h);break;case"vec2":if(!l){r.setUniform2f(o,h[0],h[1]);break}c(i.uniformName,h,l),r.setUniform2fv(o,h.flat());break;case"vec3":if(!l){r.setUniform3f(o,h[0],h[1],h[2]);break}c(i.uniformName,h,l),r.setUniform3fv(o,h.flat());break;case"vec4":if(!l){r.setUniform4f(o,h[0],h[1],h[2],h[3]);break}c(i.uniformName,h,l),r.setUniform4fv(o,h.flat());break;case"mat3":r.setUniformMatrix3fv(o,h.flat());break;case"mat4":r.setUniformMatrix4fv(o,h.flat());break;default:throw new Error(`Unable to set uniform for type ${u}`)}}}}},85058:(t,e,r)=>{r.d(e,{F:()=>h});var i=r(82392),n=r(73783),s=r(6273),o=r(51074),a=r(61985),c=r(81482),u=(r(80861),r(67498),r(26325)),l=r(68660);let h=class extends n.A{constructor(t){super(t),this.debugName="",this._updatingHandles=new l.U,this._idToUpdatingState=new o.A}get updating(){const t=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some((t=>t));if((0,s.A)("esri-2d-log-updating")){const e=Array.from(this._idToUpdatingState.entries()).map((([t,e])=>`-> ${t}: ${e}`)).join("\n");console.log(`${this.debugName}: Updating: ${t}\n-> Handles: ${this._updatingHandles.updating}\n${e}`)}return t}addUpdateTracking(t,e){const r=(0,a.wB)((()=>e.updating),(e=>this._idToUpdatingState.set(t,e)),{sync:!0});this.addHandles(r)}addPromise(t){return this._updatingHandles.addPromise(t)}};(0,i._)([(0,c.MZ)({constructOnly:!0})],h.prototype,"debugName",void 0),(0,i._)([(0,c.MZ)({readOnly:!0})],h.prototype,"updating",null),h=(0,i._)([(0,u.$)("esri.view.2d.layers.support.UpdateTracking2D")],h)},34088:(t,e,r)=>{var i;r.d(e,{c:()=>i}),function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"}(i||(i={}))}}]);